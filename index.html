            localStorage.setItem('categories', JSON.stringify(categories));
            updateCategoryCards();
            updateCategorySelect();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            updateCategoryProgress();
            updateAttributeProgress();
            updateSaveSlots();
            showToast('Progresso carregado do slot ' + (index + 1));
            toggleSaveSlots();
        }

        function updateSaveSlots() {
            const slots = document.getElementById('save-slots');
            slots.innerHTML = '';
            savedProgress.forEach((slot, index) => {
                const card = document.createElement('div');
                card.className = 'slot-card';
                card.innerHTML = `
                    <h3>Slot ${index + 1}</h3>
                    <p>${slot ? `Salvo em: ${slot.date}<br>XP: ${slot.xp} | Nível: ${slot.level}` : 'Vazio'}</p>
                    <div>
                        ${slot ? `<button class="load-btn" onclick="loadProgress(${index})"><i class="fas fa-play"></i> Carregar</button>` : ''}
                        <button class="save-btn" onclick="saveToSlot(${index})"><i class="fas fa-save"></i> Salvar</button>
                        ${slot ? `<button class="delete-btn" onclick="deleteSlot(${index})"><i class="fas fa-trash"></i> Excluir</button>` : ''}
                    </div>
                `;
                slots.appendChild(card);
            });
        }

        function deleteSlot(index) {
            if (!window.confirm('Deseja excluir este slot de progresso?')) return;
            savedProgress[index] = null;
            localStorage.setItem('savedProgress', JSON.stringify(savedProgress));
            updateSaveSlots();
            showToast('Slot ' + (index + 1) + ' excluído com sucesso!');
        }

        function updateHistory() {
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = '';
            completedTasks.forEach(task => {
                const attributeIcons = {
                    Força: 'fas fa-dumbbell',
                    Inteligência: 'fas fa-brain',
                    Vitalidade: 'fas fa-heart',
                    Sabedoria: 'fas fa-book',
                    Destreza: 'fas fa-running',
                    Humor: 'fas fa-smile'
                };
                const attributesHtml = (task.attributes || []).map(attr => `<i class="${attributeIcons[attr]}" title="${attr}"></i>`).join('');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${task.name}</td>
                    <td>${task.category}</td>
                    <td>${task.type}</td>
                    <td>${task.difficulty === 1 ? 'Fácil' : task.difficulty === 1.5 ? 'Médio' : 'Difícil'}</td>
                    <td>${task.progress}%</td>
                    <td>${attributesHtml}</td>
                    <td>${task.completedDate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function saveSettings() {
            xpDaily = parseInt(document.getElementById('xp-daily').value) || 10;
            xpWeekly = parseInt(document.getElementById('xp-weekly').value) || 50;
            xpOneTime = parseInt(document.getElementById('xp-one-time').value) || 20;
            difficultyMultipliers.easy = parseFloat(document.getElementById('difficulty-easy').value) || 1;
            difficultyMultipliers.medium = parseFloat(document.getElementById('difficulty-medium').value) || 1.5;
            difficultyMultipliers.hard = parseFloat(document.getElementById('difficulty-hard').value) || 2;
            dailyGoal = parseInt(document.getElementById('daily-goal').value) || 5;
            weeklyGoal = parseInt(document.getElementById('weekly-goal').value) || 200;
            localStorage.setItem('xpDaily', xpDaily);
            localStorage.setItem('xpWeekly', xpWeekly);
            localStorage.setItem('xpOneTime', xpOneTime);
            localStorage.setItem('difficultyMultipliers', JSON.stringify(difficultyMultipliers));
            localStorage.setItem('dailyGoal', dailyGoal);
            localStorage.setItem('weeklyGoal', weeklyGoal);
            updateScore();
            showToast('Configurações salvas com sucesso!');
        }

        function resetAll() {
            if (!window.confirm('Deseja resetar todo o progresso? Isso não pode ser desfeito.')) return;
            xp = 0;
            level = 1;
            dailyCount = 0;
            streak = 0;
            tasks = [];
            completedTasks = [];
            xpHistory = Array(7).fill(0);
            xpByCategory = {};
            attributesPoints = { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
            categories.forEach(cat => xpByCategory[cat] = 0);
            localStorage.setItem('xp', xp);
            localStorage.setItem('dailyCount', dailyCount);
            localStorage.setItem('streak', streak);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            updateCategoryProgress();
            updateAttributeProgress();
            showToast('Progresso resetado!');
        }

        function clearCache() {
            if (!window.confirm('Deseja apagar todo o cache? Isso resetará todas as configurações e progresso.')) return;
            localStorage.clear();
            savedProgress = Array(5).fill(null);
            localStorage.setItem('savedProgress', JSON.stringify(savedProgress));
            xp = 0;
            level = 1;
            dailyCount = 0;
            streak = 0;
            tasks = [];
            completedTasks = [];
            categories = ['Saúde', 'Trabalho', 'Aprendizado', 'Lazer'];
            xpHistory = Array(7).fill(0);
            xpByCategory = {};
            attributesPoints = { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
            categories.forEach(cat => xpByCategory[cat] = 0);
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            updateCategoryCards();
            updateCategorySelect();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            updateSaveSlots();
            showToast('Cache apagado com sucesso!');
        }

        function checkReset() {
            const today = new Date().toDateString();
            if (lastReset !== today) {
                tasks = tasks.map(task => {
                    if (task.type === 'daily') {
                        return { ...task, completed: false, progress: 100 };
                    }
                    return task;
                });
                dailyCount = 0;
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (lastReset === yesterday.toDateString() && dailyCount >= dailyGoal) {
                    streak++;
                } else if (lastReset !== yesterday.toDateString()) {
                    streak = 0;
                }
                lastReset = today;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('dailyCount', dailyCount);
                localStorage.setItem('streak', streak);
                localStorage.setItem('lastReset', lastReset);
            }
            const currentWeek = getWeekNumber(new Date());
            const lastWeek = lastWeeklyReset ? getWeekNumber(new Date(lastWeeklyReset)) : currentWeek;
            if (currentWeek !== lastWeek) {
                tasks = tasks.map(task => {
                    if (task.type === 'weekly') {
                        return { ...task, completed: false, progress: 100 };
                    }
                    return task;
                });
                xpHistory = Array(7).fill(0);
                lastWeeklyReset = today;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
                localStorage.setItem('lastWeeklyReset', lastWeeklyReset);
            }
            updateScore();
            updateMissions('all');
        }

        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function updateCharts() {
            const isLightTheme = document.body.classList.contains('light-theme');
            const labelColor = isLightTheme ? '#000000' : '#ffffff';
            const gridColor = isLightTheme ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
            const colors = {
                bar: isLightTheme ? ['#007bff', '#0056b3', '#003d80', '#28a745', '#1e7e34', '#155724', '#ff8c00'] : ['#ffd700', '#ff8c00', '#ff4500', '#28a745', '#1e7e34', '#155724', '#007bff'],
                radar: isLightTheme ? 'rgba(0, 123, 255, 0.5)' : 'rgba(255, 215, 0, 0.5)',
                radarBorder: isLightTheme ? '#007bff' : '#ffd700'
            };

            // Bar chart for weekly XP
            const xpChartBar = document.getElementById('xp-chart-bar').getContext('2d');
            if (window.xpChartBarInstance) window.xpChartBarInstance.destroy();
            window.xpChartBarInstance = new Chart(xpChartBar, {
                type: 'bar',
                data: {
                    labels: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
                    datasets: [{
                        label: 'XP por Dia',
                        data: xpHistory,
                        backgroundColor: colors.bar,
                        borderColor: colors.bar,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'XP', color: labelColor },
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } }
                    }
                }
            });

            // Line chart for monthly tasks completed
            const tasksChartMonthly = document.getElementById('tasks-chart-monthly').getContext('2d');
            const daysInMonth = Array.from({ length: 30 }, (_, i) => (i + 1).toString());
            const taskCounts = daysInMonth.map(day => {
                return completedTasks.filter(task => {
                    const date = new Date(task.completedDate.split('/').reverse().join('-'));
                    return date.getDate() === parseInt(day) && date.getMonth() === new Date().getMonth();
                }).length;
            });
            if (window.tasksChartMonthlyInstance) window.tasksChartMonthlyInstance.destroy();
            window.tasksChartMonthlyInstance = new Chart(tasksChartMonthly, {
                type: 'line',
                data: {
                    labels: daysInMonth,
                    datasets: [{
                        label: 'Tasks Concluídas',
                        data: taskCounts,
                        backgroundColor: colors.radar,
                        borderColor: colors.radarBorder,
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Tasks', color: labelColor },
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } }
                    }
                }
            });

            // Radar chart for category XP
            const xpChartRadar = document.getElementById('xp-chart-radar').getContext('2d');
            if (window.xpChartRadarInstance) window.xpChartRadarInstance.destroy();
            window.xpChartRadarInstance = new Chart(xpChartRadar, {
                type: 'radar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'XP por Categoria',
                        data: categories.map(cat => xpByCategory[cat] || 0),
                        backgroundColor: colors.radar,
                        borderColor: colors.radarBorder,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { color: labelColor },
                            grid: { color: gridColor },
                            pointLabels: { color: labelColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } }
                    }
                }
            });

            // Radar chart for attribute points
            const attributeChartRadar = document.getElementById('attribute-chart-radar').getContext('2d');
            if (window.attributeChartRadarInstance) window.attributeChartRadarInstance.destroy();
            window.attributeChartRadarInstance = new Chart(attributeChartRadar, {
                type: 'radar',
                data: {
                    labels: ['Força', 'Inteligência', 'Vitalidade', 'Sabedoria', 'Destreza', 'Humor'],
                    datasets: [{
                        label: 'Pontos por Atributo',
                        data: Object.values(attributesPoints),
                        backgroundColor: colors.radar,
                        borderColor: colors.radarBorder,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { color: labelColor },
                            grid: { color: gridColor },
                            pointLabels: { color: labelColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } }
                    }
                }
            });
        }

        // Initialize the application
        init();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG de Produtividade</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100vw;
        }
        body.light-theme { background-color: #f4f7fa; color: #333; }
        header {
            background-color: #121212;
            color: #e0e0e0;
            width: 100%;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
        }
        body.light-theme header { background-color: #e6f0fa; color: #333; }
        .header-icon {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            cursor: pointer;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            transition: transform 0.5s;
        }
        body.light-theme .header-icon { color: #007bff; }
        .header-icon:hover { transform: rotate(360deg); }
        .icons { display: flex; gap: clamp(5px, 1.5vw, 8px); align-items: center; flex-shrink: 0; }
        .icon-btn {
            background: linear-gradient(135deg, #0288d1, #0277bd);
            color: #e0e0e0;
            border: none;
            padding: clamp(5px, 1.2vw, 7px) clamp(10px, 2vw, 12px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s, box-shadow 0.3s;
            font-size: clamp(9px, 2vw, 11px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: clamp(3px, 0.8vw, 4px);
            white-space: nowrap;
        }
        .icon-btn i { font-size: clamp(9px, 2vw, 12px); }
        body.light-theme .icon-btn { background: linear-gradient(135deg, #42a5f5, #0288d1); color: #333; }
        .icon-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .theme-btn {
            background: linear-gradient(135deg, #0288d1, #0277bd);
            color: #e0e0e0;
            border: none;
            padding: clamp(5px, 1.2vw, 7px);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.5s, background 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .theme-btn i { font-size: clamp(9px, 2vw, 12px); }
        .theme-btn:hover { background: linear-gradient(135deg, #0277bd, #01579b); transform: rotate(360deg); }
        body.light-theme .theme-btn { background: linear-gradient(135deg, #ffb300, #ff8f00); color: #333; }
        .menu-toggle { background: none; border: none; color: #ffd700; font-size: clamp(1.2rem, 4vw, 1.8rem); cursor: pointer; }
        body.light-theme .menu-toggle { color: #007bff; }
        .sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: clamp(200px, 80vw, 250px);
            height: 100%;
            background: #121212;
            box-shadow: -2px 0 5px rgba(0,0,0,0.5);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
        }
        body.light-theme .sidebar { background: #e6f0fa; }
        .sidebar.open { right: 0; }
        .sidebar .icon-btn { width: 100%; justify-content: flex-start; font-size: clamp(10px, 2.5vw, 12px); }
        .close-sidebar {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: #e0e0e0;
            border: none;
            padding: 6px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(10px, 2.5vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        body.light-theme .close-sidebar { background: linear-gradient(135deg, #ef5350, #d32f2f); color: #333; }
        .close-sidebar:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 15px 10px;
            background: #212121;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            overflow-x: hidden;
        }
        .container.visible { opacity: 1; }
        body.light-theme .container { background: #fff; border: 2px solid #007bff; }
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; margin: 10px 5px; padding: 10px; }
        }
        .landing-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100%;
            background: linear-gradient(45deg, #4b0082, #8a2be2, #0288d1, #212121);
            background-size: 400%;
            animation: gradient 15s ease infinite;
            padding: 10px;
        }
        body.light-theme .landing-page { background: linear-gradient(45deg, #0288d1, #0277bd, #e6f0fa, #d9e7f7); }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .landing-content {
            background: #212121;
            padding: clamp(20px, 5vw, 30px);
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            text-align: center;
            animation: fadeIn 1s ease-in;
            width: 100%;
            max-width: 500px;
        }
        body.light-theme .landing-content { background: #fff; border: 2px solid #007bff; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .landing-content h1 { font-size: clamp(1.5rem, 4vw, 2rem); margin-bottom: 8px; }
        .landing-content p { font-size: clamp(0.9rem, 2.5vw, 1.1rem); margin-bottom: 15px; }
        .start-tasks-btn {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: clamp(10px, 2.5vw, 12px) clamp(20px, 4vw, 25px);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(12px, 2.5vw, 14px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: transform 0.3s, box-shadow 0.3s;
            animation: pulse 2s infinite;
            width: fit-content;
            margin: 0 auto;
        }
        body.light-theme .start-tasks-btn { background: linear-gradient(135deg, #4caf50, #388e3c); color: #333; }
        .start-tasks-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @media (max-width: 480px) {
            .landing-content { padding: 15px; }
            .landing-content h1 { font-size: clamp(1.2rem, 3.5vw, 1.6rem); }
            .landing-content p { font-size: clamp(0.8rem, 2vw, 0.9rem); }
            .start-tasks-btn { padding: clamp(8px, 2vw, 10px) clamp(15px, 3.5vw, 20px); font-size: clamp(11px, 2.2vw, 13px); }
        }
        .score-section, .settings-section, .tasks-section, .history-section, .main-menu { display: none; }
        .back-btn, .reset-btn {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: #e0e0e0;
            border: none;
            padding: clamp(10px, 2vw, 12px) clamp(20px, 4vw, 24px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(12px, 2.5vw, 14px);
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
            width: clamp(150px, 30vw, 180px);
        }
        body.light-theme .back-btn, body.light-theme .reset-btn { background: linear-gradient(135deg, #ef5350, #d32f2f); color: #333; }
        .back-btn:hover, .reset-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .reset-btn { background: linear-gradient(135deg, #388e3c, #2e7d32); }
        body.light-theme .reset-btn { background: linear-gradient(135deg, #4caf50, #388e3c); }
        .save-settings-btn {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: clamp(8px, 2vw, 10px) clamp(15px, 3.5vw, 20px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(10px, 2.5vw, 12px);
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
        }
        body.light-theme .save-settings-btn { background: linear-gradient(135deg, #4caf50, #388e3c); color: #333; }
        .save-settings-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .form-container { border: 2px solid #ffd700; border-radius: 8px; padding: 12px; margin-bottom: 12px; width: 100%; }
        body.light-theme .form-container { border: 2px solid #007bff; }
        .form-group { display: flex; flex-direction: column; align-items: center; gap: 8px; margin-bottom: 12px; }
        .form-group label { font-weight: bold; text-align: center; font-size: clamp(11px, 2.5vw, 13px); }
        .form-group input, .form-group select {
            padding: 5px;
            font-size: clamp(10px, 2.2vw, 12px);
            border-radius: 5px;
            border: 1px solid #ffd700;
            background: #424242;
            color: #e0e0e0;
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
        }
        body.light-theme .form-group input, body.light-theme .form-group select { background: #e6f0fa; color: #333; border: 1px solid #007bff; }
        .form-group button {
            background: linear-gradient(135deg, #0288d1, #0277bd);
            color: #e0e0e0;
            border: none;
            padding: 6px 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(10px, 2.5vw, 12px);
            margin: 8px auto;
            display: block;
        }
        .form-group button:hover { background: linear-gradient(135deg, #0277bd, #01579b); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        body.light-theme .form-group button { background: linear-gradient(135deg, #ffb300, #ff8f00); color: #333; }
        .attribute-buttons { display: flex; flex-wrap: wrap; gap: clamp(6px, 1.5vw, 8px); justify-content: center; width: 100%; margin: 8px auto; padding: 0 clamp(8px, 1.5vw, 15px); }
        .attribute-btn {
            background: linear-gradient(135deg, #424242, #212121);
            color: #e0e0e0;
            border: 2px solid #ffd700;
            padding: clamp(6px, 1.5vw, 8px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s, border-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(3px, 0.8vw, 4px);
            font-size: clamp(10px, 2.2vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            flex: 1;
            min-width: clamp(90px, 18vw, 110px);
            max-width: clamp(100px, 22vw, 130px);
        }
        .attribute-btn i { font-size: clamp(10px, 2.5vw, 14px); }
        .attribute-btn.selected { background: linear-gradient(135deg, #388e3c, #2e7d32); border-color: #388e3c; transform: scale(1.05); }
        body.light-theme .attribute-btn { background: linear-gradient(135deg, #e6f0fa, #d9e7f7); color: #333; border: 2px solid #007bff; }
        body.light-theme .attribute-btn.selected { background: linear-gradient(135deg, #4caf50, #388e3c); border-color: #4caf50; }
        .attribute-btn:hover { transform: scale(1.1); box-shadow: 0 3px 6px rgba(0,0,0,0.4); }
        .task-card {
            background: linear-gradient(135deg, #424242, #212121);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 300px;
            min-width: 0;
            font-size: clamp(12px, 5vw, 15px);
            margin: 0 auto;
            box-sizing: border-box;
        }
        .task-card .task-content {
          text-align: center;
      }
        body.light-theme .task-card { background: linear-gradient(135deg, #e6f0fa, #d9e7f7); }
        .task-card:hover { transform: scale(1.05); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
        .task-card .icons { display: flex; gap: 8px; justify-content: flex-end; }
        .task-card .icons i { cursor: pointer; font-size: clamp(12px, 3vw, 14px); color: #ffd700; transition: color 0.2s; }
        .task-card .attributes { display: flex; gap: clamp(6px, 1.5vw, 8px); flex-wrap: wrap; }
        .task-card .attributes i { font-size: clamp(12px, 3vw, 14px); color: #ffd700; }
        body.light-theme .task-card .attributes i, body.light-theme .task-card .icons i { color: #007bff; }
        .task-card .icons i:hover { color: #ff8c00; }
        body.light-theme .task-card .icons i:hover { color: #0056b3; }
        .progress-bar { margin: 8px 0; width: 100%; }
        .progress-bar progress { width: 100%; height: 18px; }
        .missions-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            grid-column: span 2;
            width: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 500px;
            padding: 5px;
            justify-content: center;
        }
        .missions-grid::-webkit-scrollbar { width: 6px; }
        .missions-grid::-webkit-scrollbar-track { background: #212121; }
        body.light-theme .missions-grid::-webkit-scrollbar-track { background: #e6f0fa; }
        .missions-grid::-webkit-scrollbar-thumb { background: #ffd700; border-radius: 4px; }
        body.light-theme .missions-grid::-webkit-scrollbar-thumb { background: #007bff; }
        .mission-card {
            background: linear-gradient(135deg, #424242, #212121);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            flex: 1 1 clamp(140px, 30vw, 160px);
            min-width: 0;
            text-align: center;
            min-height: 180px;
            box-sizing: border-box;
        }
        body.light-theme .mission-card { background: linear-gradient(135deg, #e6f0fa, #d9e7f7); }
        @media (max-width: 600px) { .mission-card { flex: 1 1 clamp(120px, 45vw, 140px); min-height: 160px; } }
        @media (max-width: 400px) { .mission-card { flex: 1 1 95%; min-height: 140px; } }
        .mission-card:hover { transform: scale(1.05); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
        .mission-card .attributes { display: flex; gap: clamp(6px, 1.5vw, 8px); justify-content: center; margin-bottom: 8px; flex-wrap: wrap; }
        .mission-card .attributes i { font-size: clamp(10px, 2.5vw, 12px); color: #ffd700; }
        body.light-theme .mission-card .attributes i { color: #007bff; }
        .mission-card button {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: clamp(10px, 2.2vw, 11px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 4px;
        }
        body.light-theme .mission-card button { background: linear-gradient(135deg, #4caf50, #388e3c); color: #333; }
        .mission-card button.cancel-btn { background: linear-gradient(135deg, #d32f2f, #b71c1c); }
        body.light-theme .mission-card button.cancel-btn { background: linear-gradient(135deg, #ef5350, #d32f2f); }
        .mission-card button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .mission-card input[type="range"] {
            -webkit-appearance: none;
            width: 95%;
            max-width: 100px;
            height: 6px;
            background: linear-gradient(to right, #4b0082 0%, #4b0082 var(--value), #8a2be2 var(--value), #8a2be2 100%);
            border: 1px solid #ffd700;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        body.light-theme .mission-card input[type="range"] {
            background: linear-gradient(to right, #007bff 0%, #007bff var(--value), #0056b3 var(--value), #0056b3 100%);
            border: 1px solid #007bff;
        }
        .mission-card input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
        }
        .mission-card input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
        }
        body.light-theme .mission-card input[type="range"]::-webkit-slider-thumb { background: #ff8c00; }
        body.light-theme .mission-card input[type="range"]::-moz-range-thumb { background: #ff8c00; }
        .mission-card input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        .mission-card input[type="range"]::-moz-range-thumb:hover { transform: scale(1.2); }
        .mission-card .task-actions { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .xp-bar {
            width: 100%;
            max-width: 600px;
            margin: 15px auto;
            text-align: center;
            background: linear-gradient(135deg, #4b0082, #8a2be2);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.5);
        }
        body.light-theme .xp-bar { background: linear-gradient(135deg, #0288d1, #0277bd); }
        .xp-bar progress { width: 100%; height: 18px; accent-color: #ab47bc; background: transparent; border-radius: 8px; }
        body.light-theme .xp-bar progress { accent-color: #007bff; }
        .xp-bar span { display: block; margin-top: 4px; font-weight: bold; font-size: clamp(11px, 2.5vw, 13px); }
        .toast {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: #388e3c;
            color: #e0e0e0;
            padding: 8px 15px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            font-size: clamp(10px, 2.5vw, 12px);
        }
        body.light-theme .toast { background: #4caf50; color: #333; }
        .toast.show { opacity: 1; }
        .category-cards { display: flex; flex-wrap: wrap; gap: 8px; width: 100%; }
        .category-card { background: #424242; padding: 8px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; flex: 1; min-width: clamp(120px, 30vw, 150px); }
        body.light-theme .category-card { background: #e6f0fa; }
        .category-card input { flex-grow: 1; max-width: 250px; width: 100%; margin: 0 auto; font-size: clamp(10px, 2.2vw, 12px); }
        .start-mission-btn {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: 8px;
            border-radius: 20px;
            cursor: pointer;
            font-size: clamp(10px, 2.5vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            flex: 0 1 auto;
            min-width: clamp(60px, 20vw, 80px);
            text-align: center;
            white-space: nowrap;
        }
        body.light-theme .start-mission-btn { background: linear-gradient(135deg, #4caf50, #388e3c); color: #333; }
        .start-mission-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .category-select { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 15px 0; width: 100%; padding-bottom: 5px; }
        .main-menu h2, .main-menu p { display: block; margin: 8px 0; text-align: center; font-size: clamp(1.2rem, 3.5vw, 1.6rem); }
        .main-menu p { font-size: clamp(0.9rem, 2.5vw, 1.1rem); }
        .charts-container { display: flex; flex-wrap: wrap; gap: 15px; grid-column: span 2; width: 100%; justify-content: center; }
        .charts-container canvas { background-color: #424242; max-width: 400px; max-height: 300px; width: 100%; height: 300px; aspect-ratio: 4 / 3; }
        body.light-theme .charts-container canvas { background-color: #ffffff; }
        @media (max-width: 768px) { .charts-container { flex-direction: column; align-items: center; } .charts-container div { width: 100%; max-width: 400px; } }
        .category-progress-card, .attribute-progress-card {
            background: linear-gradient(135deg, #424242, #212121);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: transform 0.2s;
            flex: 1;
            min-width: clamp(140px, 30vw, 160px);
        }
        body.light-theme .category-progress-card, body.light-theme .attribute-progress-card { background: linear-gradient(135deg, #e6f0fa, #d9e7f7); }
        .category-progress-card:hover, .attribute-progress-card:hover { transform: scale(1.05); }
        .tasks-grid { display: flex; flex-wrap: wrap; gap: 12px; grid-column: span 2; width: 100%; overflow-y: hidden; overflow-x: hidden; justify-content: center; box-sizing: border-box; }
        .history-table { width: 100%; border-collapse: collapse; margin: 15px 0; grid-column: span 2; font-size: clamp(10px, 2.2vw, 12px);max-height: none;overflow-y: visible; }
        .history-section {max-height: none; overflow-y: visible;}
        .history-table th, .history-table td { border: 1px solid #ffd700; padding: 8px; text-align: left; word-wrap: break-word; }
        body.light-theme .history-table th, body.light-theme .history-table td { border: 1px solid #007bff; }
        .history-table th { background: #424242; }
        body.light-theme .history-table th { background: #e6f0fa; }
        .history-table tr:nth-child(even) { background: #212121; }
        body.light-theme .history-table tr:nth-child(even) { background: #e6f0fa; }
        .settings-actions { display: flex; gap: 8px; grid-column: span 2; justify-content: center; align-items: center; flex-wrap: wrap; }
        .button-container { display: flex; gap: 8px; grid-column: span 2; justify-content: center; align-items: center; flex-wrap: wrap; margin-top: 20px; }
        .sub-tabs, .filter-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .sub-tab-btn, .filter-btn {
            background: linear-gradient(135deg, #0288d1, #0277bd);
            color: #e0e0e0;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(10px, 2.5vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, background 0.3s;
        }
        
        body.light-theme .sub-tab-btn, body.light-theme .filter-btn {
            background: linear-gradient(135deg, #42a5f5, #0288d1);
            color: #333;
        }
        
        .sub-tab-btn:hover, .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .sub-tab-btn.active, .filter-btn.active {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
        }
        
        body.light-theme .sub-tab-btn.active, body.light-theme .filter-btn.active {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }
        
        .task-total-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            overflow-y: auto;
            overflow-x: hidden; /* Already present, keep it */
            max-height: 400px;
            width: 100%; /* Ensure it takes full width of parent */
            box-sizing: border-box; /* Ensure padding/borders are included in width */
        }
        
        .task-total-card {
            background: linear-gradient(135deg, #424242, #212121);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: transform 0.2s;
            flex: 1 1 clamp(140px, 30vw, 160px); /* Keep flexible sizing */
            max-width: 90%; /* Prevent cards from exceeding container width */
            min-width: 0; /* Allow cards to shrink if needed */
            text-align: center;
            box-sizing: border-box; /* Include padding/borders in width */
        }
        
         body.light-theme .task-total-card {
            background: linear-gradient(135deg, #e6f0fa, #d9e7f7);
        }
        
        .task-total-card:hover {
            transform: scale(0.95);
        }
        
        .task-total-card h4 {
            margin-bottom: 5px;
        }
        
        .task-total-card p {
            margin: 3px 0;
            font-size: clamp(10px, 2.2vw, 12px);
        }
        
        /* Ensure no horizontal scrollbar on smaller screens */
        @media (max-width: 600px) {
            .task-total-card {
                flex: 1 1 clamp(120px, 45vw, 140px); /* Adjust for smaller screens */
                max-width: 95%; /* Ensure it fits within container */
            }
        }
        
        @media (max-width: 400px) {
            .task-total-card {
                flex: 1 1 100%; /* Full width on very small screens */
                max-width: 95%; /* Ensure it fits */
            }
        }
        .save-grid {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 12px;
                    grid-column: span 2;
                    width: 100%;
                    overflow-y: auto;
                    overflow-x: hidden;
                    max-height: 500px;
                    padding: 5px;
                    justify-content: center;
                }
                
                .save-grid::-webkit-scrollbar { width: 6px; }
                .save-grid::-webkit-scrollbar-track { background: #212121; }
                body.light-theme .save-grid::-webkit-scrollbar-track { background: #e6f0fa; }
                .save-grid::-webkit-scrollbar-thumb { background: #ffd700; border-radius: 4px; }
                body.light-theme .save-grid::-webkit-scrollbar-thumb { background: #007bff; }
                
                .save-card {
                    background: linear-gradient(135deg, #424242, #212121);
                    padding: 10px;
                    border-radius: 8px;
                    box-shadow: 0 3px 6px rgba(0,0,0,0.4);
                    transition: transform 0.2s;
                    flex: 1 1 clamp(140px, 30vw, 160px);
                    min-width: 0;
                    text-align: center;
                    min-height: 160px;
                    box-sizing: border-box;
                    position: relative;
                }
                
                body.light-theme .save-card { background: linear-gradient(135deg, #e6f0fa, #d9e7f7); }
                .save-card:hover { transform: scale(1.05); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
                .save-card h4 { margin-bottom: 5px; font-size: clamp(12px, 2.5vw, 14px); }
                .save-card p { margin: 3px 0; font-size: clamp(10px, 2.2vw, 12px); }
                .save-card .icons { position: absolute; top: 5px; right: 5px; }
                .save-card .icons i { cursor: pointer; font-size: clamp(12px, 3vw, 14px); color: #ffd700; transition: color 0.2s; }
                body.light-theme .save-card .icons i { color: #007bff; }
                .save-card .icons i:hover { color: #ff8c00; }
                body.light-theme .save-card .icons i:hover { color: #0056b3; }
                .save-card .task-actions { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 10px; }
                .save-card .task-actions button {
                    background: linear-gradient(135deg, #388e3c, #2e7d32);
                    color: #e0e0e0;
                    border: none;
                    padding: 6px 12px;
                    border-radius: 16px;
                    cursor: pointer;
                    font-size: clamp(10px, 2.2vw, 11px);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    transition: transform 0.3s, box-shadow 0.3s;
                }
                body.light-theme .save-card .task-actions button { background: linear-gradient(135deg, #4caf50, #388e3c); color: #333; }
                .save-card .task-actions button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
                .save-card .task-actions button.load-btn { background: linear-gradient(135deg, #0288d1, #0277bd); }
                body.light-theme .save-card .task-actions button.load-btn { background: linear-gradient(135deg, #42a5f5, #0288d1); }
                .button-container {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 10px;
                    justify-content: center;
                    align-items: center;
                    margin-top: 15px;
                }
                .import-btn {
                    padding: clamp(5px, 1.2vw, 7px) clamp(10px, 2vw, 12px);
                    font-size: clamp(9px, 2vw, 11px);
                }
                body.light-theme .import-btn {
                    background: linear-gradient(135deg, #42a5f5, #0288d1);
                    color: #333;
                }
                .import-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
                }
                .submit-btn {
                    background: linear-gradient(135deg, #388e3c, #2e7d32);
                    color: #e0e0e0;
                    border: none;
                    padding: clamp(8px, 2vw, 10px) clamp(16px, 3vw, 20px);
                    border-radius: 8px;
                    cursor: pointer;
                    transition: transform 0.3s, box-shadow 0.3s;
                    font-size: clamp(12px, 2.5vw, 14px);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }
                body.light-theme .submit-btn {
                    background: linear-gradient(135deg, #4caf50, #388e3c);
                    color: #333;
                }
                .submit-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
                }
                .file-name {
                    font-size: clamp(10px, 2.2vw, 12px);
                    color: #e0e0e0;
                    margin: 8px 0;
                    text-align: center;
                    max-width: 95%;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                }
                body.light-theme .file-name {
                    color: #333;
                }
          @media (max-width: 400px) {
              .task-total-card {
                  flex: 1 1 95%;
                  max-width: 95%;
              }
          }

        .delete-all-btn {
            background: linear-gradient(135deg, #b71c1c, #7f0000);
            color: #e0e0e0;
            border: none;
            padding: clamp(10px, 2vw, 12px) clamp(20px, 4vw, 24px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(12px, 2.5vw, 14px);
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
            width: clamp(150px, 30vw, 180px);
        }
        body.light-theme .delete-all-btn {
            background: linear-gradient(135deg, #d32f2f, #9a0000);
            color: #333;
        }
        .delete-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }



        .task-total-card .icons {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 8px;
        }
        .task-total-card .icons i {
            cursor: pointer;
            font-size: clamp(12px, 3vw, 14px);
            color: #ffd700;
            transition: color 0.2s;
        }
        body.light-theme .task-total-card .icons i {
            color: #007bff;
        }
        .task-total-card .icons i:hover {
            color: #ff8c00;
        }
        body.light-theme .task-total-card .icons i:hover {
            color: #0056b3;
        }
        
        .task-card.edit-mode {
            padding: 10px;
            position: relative;
        }
        
        .task-card .edit-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .task-card .edit-form input,
        .task-card .edit-form select {
            padding: 5px;
            font-size: clamp(10px, 2.2vw, 12px);
            border-radius: 5px;
            border: 1px solid #ffd700;
            background: #424242;
            color: #e0e0e0;
            width: 100%;
            box-sizing: border-box;
        }
        
        body.light-theme .task-card .edit-form input,
        body.light-theme .task-card .edit-form select {
            background: #e6f0fa;
            color: #333;
            border: 1px solid #007bff;
        }
        
        .task-card .edit-form .attribute-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(6px, 1.5vw, 8px);
            justify-content: center;
            width: 100%;
        }
        
        .task-card .edit-form button {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(10px, 2.2vw, 12px);
            margin-top: 8px;
        }
        
        body.light-theme .task-card .edit-form button {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: #333;
        }
        
        .task-card .edit-form button.cancel-btn {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
        }
        
        body.light-theme .task-card .edit-form button.cancel-btn {
            background: linear-gradient(135deg, #ef5350, #d32f2f);
        }
        
        .task-card .edit-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }


        .task-card .edit-form .attribute-buttons .attribute-btn.selected {
            background: linear-gradient(135deg, #ffb300, #ff8f00); /* Amarelo para tema escuro */
            border-color: #ffb300; /* Borda amarela */
            transform: scale(1.05);
        }
        
        body.light-theme .task-card .edit-form .attribute-buttons .attribute-btn.selected {
            background: linear-gradient(135deg, #ffca28, #ffb300); /* Amarelo mais claro para tema claro */
            border-color: #ffca28; /* Borda amarela mais clara */
        }


        /* Estilo para os botões de paginação */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: clamp(8px, 2vw, 10px);
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .pagination-btn {
            background: linear-gradient(135deg, #0288d1, #0277bd);
            color: #e0e0e0;
            border: none;
            padding: clamp(6px, 1.5vw, 8px) clamp(12px, 2.5vw, 15px);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(10px, 2.2vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
        }
        
        body.light-theme .pagination-btn {
            background: linear-gradient(135deg, #42a5f5, #0288d1);
            color: #333;
        }
        
        .pagination-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .pagination-btn.active {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
        }
        
        body.light-theme .pagination-btn.active {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }
        
        .pagination-btn:disabled {
            background: linear-gradient(135deg, #616161, #424242);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        body.light-theme .pagination-btn:disabled {
            background: linear-gradient(135deg, #b0bec5, #90a4ae);
        }

        .task-card .attributes, .mission-card .attributes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center; /* Alinhar à esquerda para melhor organização */
            min-height: 20px; /* Garantir espaço mínimo para os ícones */
        }
        
        .task-card .attributes i, .mission-card .attributes i {
            font-size: clamp(12px, 3vw, 14px);
            color: #ffd700;
        }
        
        body.light-theme .task-card .attributes i, body.light-theme .mission-card .attributes i {
            color: #007bff;
        }

        /* Estilo para o diálogo de confirmação */
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #424242, #212121);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: clamp(10px, 2vw, 12px);
            width: clamp(200px, 80vw, 300px);
            text-align: center;
            font-size: clamp(12px, 2.5vw, 14px);
        }
        body.light-theme .confirmation-dialog {
            background: linear-gradient(135deg, #e6f0fa, #d9e7f7);
            border: 2px solid #007bff;
        }
        .confirmation-dialog p {
            margin: 0;
            color: #e0e0e0;
        }
        body.light-theme .confirmation-dialog p {
            color: #333;
        }
        .confirmation-dialog .dialog-buttons {
            display: flex;
            justify-content: center;
            gap: clamp(8px, 2vw, 10px);
        }
        .confirmation-dialog button {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: clamp(6px, 1.5vw, 8px) clamp(12px, 2.5vw, 15px);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(10px, 2.2vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        body.light-theme .confirmation-dialog button {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: #333;
        }
        .confirmation-dialog button.cancel-btn {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
        }
        body.light-theme .confirmation-dialog button.cancel-btn {
            background: linear-gradient(135deg, #ef5350, #d32f2f);
        }
        .confirmation-dialog button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }


        .task-total-card .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
            width: 100%;
        }
        
        .task-total-card .progress-bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .task-total-card .progress-bar-container label {
            font-size: clamp(9px, 2vw, 10px);
            color: #e0e0e0;
        }
        
        body.light-theme .task-total-card .progress-bar-container label {
            color: #333;
        }
        
        .task-total-card .progress-bar-container progress {
            width: 100%;
            max-width: 120px;
            height: 10px;
            border-radius: 5px;
            background: #212121;
            border: 1px solid #ffd700;
        }
        
        body.light-theme .task-total-card .progress-bar-container progress {
            background: #e6f0fa;
            border: 1px solid #007bff;
        }
        
        .task-total-card .progress-bar-container progress::-webkit-progress-bar {
            background: transparent;
            border-radius: 5px;
        }
        
        .task-total-card .progress-bar-container progress::-webkit-progress-value {
            background: linear-gradient(135deg, #4b0082, #8a2be2);
            border-radius: 5px;
        }
        
        body.light-theme .task-total-card .progress-bar-container progress::-webkit-progress-value {
            background: linear-gradient(135deg, #0288d1, #0277bd);
        }
        
        .task-total-card .progress-bar-container progress::-moz-progress-bar {
            background: linear-gradient(135deg, #4b0082, #8a2be2);
            border-radius: 5px;
        }
        
        body.light-theme .task-total-card .progress-bar-container progress::-moz-progress-bar {
            background: linear-gradient(135deg, #0288d1, #0277bd);
        }


        /* Estilo para o botão Resetar Task */
        .reset-task-btn {
            background: linear-gradient(135deg, #ffb300, #ff8f00); /* Amarelo para tema escuro */
            color: #e0e0e0;
            border: none;
            padding: clamp(10px, 2vw, 12px) clamp(20px, 4vw, 24px);
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(12px, 2.5vw, 14px);
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: center;
            width: clamp(150px, 30vw, 180px);
        }
        body.light-theme .reset-task-btn {
            background: linear-gradient(135deg, #ffca28, #ffb300); /* Amarelo mais claro para tema claro */
            color: #333;
        }
        .reset-task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        /* Estilo para o diálogo de reset */
        .reset-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #424242, #212121);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: clamp(10px, 2vw, 12px);
            width: clamp(200px, 80vw, 300px);
            text-align: center;
            font-size: clamp(12px, 2.5vw, 14px);
        }
        body.light-theme .reset-dialog {
            background: linear-gradient(135deg, #e6f0fa, #d9e7f7);
            border: 2px solid #007bff;
        }
        .reset-dialog p {
            margin: 0;
            color: #e0e0e0;
        }
        body.light-theme .reset-dialog p {
            color: #333;
        }
        .reset-dialog .dialog-buttons {
            display: flex;
            justify-content: center;
            gap: clamp(8px, 2vw, 10px);
            flex-wrap: wrap;
        }
        .reset-dialog button {
            background: linear-gradient(135deg, #388e3c, #2e7d32);
            color: #e0e0e0;
            border: none;
            padding: clamp(6px, 1.5vw, 8px) clamp(12px, 2.5vw, 15px);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(10px, 2.2vw, 12px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        body.light-theme .reset-dialog button {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: #333;
        }
        .reset-dialog button.cancel-btn {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
        }
        body.light-theme .reset-dialog button.cancel-btn {
            background: linear-gradient(135deg, #ef5350, #d32f2f);
        }
        .reset-dialog button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }



    </style>
</head>
<body>
    <div class="landing-page" id="landing-page">
        <div class="landing-content">
            <h1>Bem-vindo ao RPG de Produtividade!</h1>
            <p>Transforme suas tarefas em aventuras épicas!</p>
            <button class="start-tasks-btn" onclick="showMenu()">Iniciar Tarefas</button>
        </div>
    </div>
    <header style="display: none;" id="header">
        <i class="fas fa-dice header-icon" onclick="showMenu()" title="RPG de Produtividade"></i>
        <div class="icons">
            <button class="icon-btn" onclick="showMenu()" aria-label="Abrir Menu Principal"><i class="fas fa-home"></i> Menu</button>
            <button class="theme-btn" onclick="toggleTheme()" aria-label="Alternar Tema"><i class="fas fa-sun"></i></button>
            <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Abrir Menu Lateral"><i class="fas fa-bars"></i></button>
        </div>
    </header>
    <div class="sidebar" id="sidebar">
        <button class="close-sidebar" onclick="toggleSidebar()"><i class="fas fa-times"></i> Fechar</button>
        <button class="icon-btn" onclick="showTasks(); toggleSidebar()" aria-label="Cadastrar Tasks"><i class="fas fa-plus"></i> Cadastrar</button>
        <button class="icon-btn" onclick="showScore(); toggleSidebar()" aria-label="Ver Progresso"><i class="fas fa-trophy"></i> Progresso</button>
        <button class="icon-btn" onclick="showHistory(); toggleSidebar()" aria-label="Ver Histórico"><i class="fas fa-history"></i> Histórico</button>
        <button class="icon-btn" onclick="showSave(); toggleSidebar()" aria-label="Salvar/Carregar"><i class="fas fa-save"></i> Salvar/Carregar</button>
        <button class="icon-btn" onclick="showSettings(); toggleSidebar()" aria-label="Configurações"><i class="fas fa-cog"></i> Configurações</button>
    </div>
    <div class="xp-bar" style="display: none;" id="xp-bar">
        <progress id="global-xp" value="0" max="100"></progress>
        <span id="xp-label">XP: 0 / 100 (Nível 1)</span>
    </div>
      <div class="container main-menu" id="main-menu" style="display: none;">
          <h2>Bem-vindo ao RPG de Produtividade!</h2>
          <p>Complete tasks, ganhe XP e suba de nível!</p>
          <div class="category-select" id="category-select"></div>
          <div class="missions-grid" id="missions-grid"></div>
          <div class="button-container">
              <button class="reset-task-btn" onclick="showResetDialog()"><i class="fas fa-redo"></i> Resetar Task</button>
          </div>
      </div>
    <div class="container tasks-section" id="tasks-container" style="display: none;">
        <h2>Cadastrar e Gerenciar Tasks</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="task-name">Nova Task:</label>
                <input type="text" id="task-name" placeholder="Nome da task">
                <label for="task-category">Categoria:</label>
                <select id="task-category"></select>
                <label for="task-type">Tipo:</label>
                <select id="task-type">
                    <option value="Diário">Diário</option>
                    <option value="Semanal">Semanal</option>
                    <option value="Única">Única</option>
                </select>
                <label for="task-difficulty">Pontuação:</label>
                <select id="task-difficulty">
                    <option value="1">Baixa</option>
                    <option value="1.5">Média</option>
                    <option value="2">Alta</option>
                </select>
                <label>Atributos:</label>
                <div class="attribute-buttons" id="attribute-buttons">
                    <button type="button" class="attribute-btn" data-attribute="Força"><i class="fas fa-dumbbell"></i> Força</button>
                    <button type="button" class="attribute-btn" data-attribute="Inteligência"><i class="fas fa-brain"></i> Inteligência</button>
                    <button type="button" class="attribute-btn" data-attribute="Vitalidade"><i class="fas fa-heart"></i> Vitalidade</button>
                    <button type="button" class="attribute-btn" data-attribute="Sabedoria"><i class="fas fa-book"></i> Sabedoria</button>
                    <button type="button" class="attribute-btn" data-attribute="Destreza"><i class="fas fa-running"></i> Destreza</button>
                    <button type="button" class="attribute-btn" data-attribute="Humor"><i class="fas fa-smile"></i> Humor</button>
                </div>
                <button onclick="addTask()">Adicionar Task</button>
            </div>
        </div>
        <h3>Tasks Cadastradas</h3>
        <div class="tasks-grid" id="tasks-grid"></div>
        <div class="button-container">
            <button class="back-btn" onclick="showMenu()">Voltar ao Menu Principal</button>
            <button class="reset-btn" onclick="clearAllTasks()" title="Apagar Todas as Tasks"><i class="fas fa-trash"></i> Apagar todas as Tasks</button>
        </div>
    </div>
    <div class="container score-section" id="score-container" style="display: none;">
        <h2>Seu Progresso</h2>
        <p>XP: <span id="xp">0</span> | Nível: <span id="level">1</span> | Sequência: <span id="streak">0</span> dias</p>
        <div class="progress-bar">
            <label>Objetivo Diário (<span id="daily-goal-label">5</span> tasks):</label>
            <progress id="daily-progress" value="0" max="5"></progress>
        </div>
        <div class="progress-bar">
            <label>Objetivo Semanal (<span id="weekly-goal-label">200</span> XP):</label>
            <progress id="weekly-progress" value="0" max="200"></progress>
        </div>
        <h3>Progresso por Categoria</h3>
        <div class="missions-grid" id="category-progress"></div>
        <h3>Progresso por Atributo</h3>
        <div class="missions-grid" id="attribute-progress"></div>
        <div class="charts-container">
            <div><h3>Gráfico de XP Semanal</h3><canvas id="xp-chart-bar" width="400" height="300"></canvas></div>
            <div><h3>Tasks Concluídas (Mensal)</h3><canvas id="tasks-chart-monthly" width="400" height="300"></canvas></div>
            <div><h3>Tasks Concluídas (Anual)</h3><canvas id="tasks-chart-yearly" width="400" height="300"></canvas></div>
            <div><h3>Desempenho por Categoria</h3><canvas id="xp-chart-radar" width="400" height="300"></canvas></div>
            <div><h3>Desempenho por Atributo</h3><canvas id="attribute-chart-radar" width="400" height="300"></canvas></div>
        </div>
        <div class="button-container">
            <button class="back-btn" onclick="showMenu()">Voltar ao Menu Principal</button>
            <button class="reset-btn" onclick="resetAll()" title="Resetar Progresso"><i class="fas fa-redo"></i> Resetar Tudo</button>
        </div>
    </div>
        <div class="container history-section" id="history-container" style="display: none;">
            <h2>Histórico de Tasks Concluídas</h2>
            <div class="sub-tabs">
                <button class="sub-tab-btn active" onclick="showHistoryView('table')">Tabela</button>
                <button class="sub-tab-btn" onclick="showHistoryView('total')">Cards</button>
            </div>
          <div id="history-table-view">
              <table class="history-table">
                  <thead>
                      <tr><th>Nome</th><th>Categoria</th><th>Tipo</th><th>Total (%)</th><th>Data</th></tr>
                  </thead>
                  <tbody id="history-table-body"></tbody>
              </table>
              <div class="pagination-container" id="pagination-controls"></div>
          </div>
            <div id="task-total-view" style="display: none;">
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterTaskTotals('repetitivo')">Repetitivo</button>
                    <button class="filter-btn" onclick="filterTaskTotals('unica')">Task Única</button>
                </div>
                <div class="task-total-grid" id="task-total-grid"></div>
            </div>
            <div class="button-container">
                <button class="back-btn" onclick="showMenu()">Voltar ao Menu Principal</button>
                <button class="reset-btn" onclick="clearHistory()" title="Apagar Histórico"><i class="fas fa-trash"></i> Apagar Histórico</button>
            </div>
        </div>
    <div class="container settings-section" id="settings-container" style="display: none;">
        <h2>Configurações</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="new-category">Adicionar Categoria:</label>
                <input type="text" id="new-category" placeholder="Nova categoria">
                <button type="button" onclick="addCategory()">Adicionar</button>
            </div>
            <div class="form-group">
                <label>Categorias Atuais:</label>
                <div class="category-cards" id="category-cards"></div>
            </div>
            <div class="form-group"><label for="xp-daily">XP para Diárias:</label><input type="number" id="xp-daily" value="10"></div>
            <div class="form-group"><label for="xp-weekly">XP para Semanais:</label><input type="number" id="xp-weekly" value="50"></div>
            <div class="form-group"><label for="xp-one-time">XP para Únicas:</label><input type="number" id="xp-one-time" value="20"></div>
            <div class="form-group"><label for="difficulty-easy">Multiplicador Baixa:</label><input type="number" id="difficulty-easy" step="0.1" value="1"></div>
            <div class="form-group"><label for="difficulty-medium">Multiplicador Média:</label><input type="number" id="difficulty-medium" step="0.1" value="1.5"></div>
            <div class="form-group"><label for="difficulty-hard">Multiplicador Alta:</label><input type="number" id="difficulty-hard" step="0.1" value="2"></div>
            <div class="form-group"><label for="daily-goal">Objetivo Diário (tasks):</label><input type="number" id="daily-goal" value="5"></div>
            <div class="form-group"><label for="weekly-goal">Objetivo Semanal (XP):</label><input type="number" id="weekly-goal" value="200"></div>
            <div class="form-group">
                <button class="save-settings-btn" onclick="saveSettings()"><i class="fas fa-save"></i> Salvar Configurações</button>
                <button class="reset-btn" type="button" onclick="resetAll()"><i class="fas fa-redo"></i> Resetar Tudo</button>
            </div>
        </div>
        <div class="button-container">
            <button class="back-btn" onclick="showMenu()">Voltar ao Menu Principal</button>
            <button class="delete-all-btn" onclick="deleteAllData()" title="Apagar Todos os Dados"><i class="fas fa-trash-alt"></i> Apagar Todos os Dados</button>
        </div>
    </div>
        <div class="container save-section" id="save-container" style="display: none;">
            <h2>Salvar/Carregar Jogo</h2>
            <div class="save-grid" id="save-grid"></div>
            <div class="button-container">
                <button class="back-btn" onclick="showMenu()">Voltar ao Menu Principal</button>
                <button class="icon-btn" onclick="exportSaveData()" title="Exportar Dados"><i class="fas fa-download"></i> Exportar</button>
                <button class="icon-btn" onclick="document.getElementById('file-input').click()" title="Importar Dados"><i class="fas fa-upload"></i> Importar</button>
                <input type="file" id="file-input" accept=".json" style="display: none;" onchange="handleFileSelect(event)">
                <p id="file-name" class="file-name">Nenhum arquivo selecionado</p>
                <button class="icon-btn submit-btn" onclick="importSaveData()" id="submit-file" style="display: none;"><i class="fas fa-check"></i> Enviar</button>
            </div>
        <div class="confirmation-dialog" id="confirmation-dialog">
            <p>Salvar o jogo no Slot <span id="slot-number"></span>? Isso substituirá os dados existentes.</p>
            <div class="dialog-buttons">
                <button onclick="confirmSave()">Confirmar</button>
                <button class="cancel-btn" onclick="cancelSave()">Cancelar</button>
            </div>
        </div>
        </div>
    <div class="toast" id="toast"></div>
    
    <div class="reset-dialog" id="reset-dialog">
        <p>Escolha o tipo de tasks para resetar:</p>
        <div class="dialog-buttons">
            <button onclick="resetTasks('daily')">Diárias</button>
            <button onclick="resetTasks('weekly')">Semanal</button>
            <button class="cancel-btn" onclick="closeResetDialog()">Cancelar</button>
        </div>
    </div>
    
    <script>
        let chartData = JSON.parse(localStorage.getItem('chartData')) || [];
        let currentCategory = 'all'; // Adiciona no início do script, junto com outras variáveis globais
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || ['Saúde', 'Trabalho', 'Aprendizado', 'Lazer'];
        let xp = parseInt(localStorage.getItem('xp')) || 0;
        let level = Math.floor(xp / 100) + 1;
        let dailyCount = parseInt(localStorage.getItem('dailyCount')) || 0;
        let streak = parseInt(localStorage.getItem('streak')) || 0;
        let lastReset = localStorage.getItem('lastReset') || new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        let lastWeeklyReset = localStorage.getItem('lastWeeklyReset') || new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
        let xpHistory = JSON.parse(localStorage.getItem('xpHistory')) || Array(7).fill(0);
        let xpByCategory = JSON.parse(localStorage.getItem('xpByCategory')) || {};
        let attributesPoints = JSON.parse(localStorage.getItem('attributesPoints')) || { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
        let xpDaily = parseInt(localStorage.getItem('xpDaily')) || 10;
        let xpWeekly = parseInt(localStorage.getItem('xpWeekly')) || 50;
        let xpOneTime = parseInt(localStorage.getItem('xpOneTime')) || 20;
        let difficultyMultipliers = JSON.parse(localStorage.getItem('difficultyMultipliers')) || { easy: 1, medium: 1.5, hard: 2 };
        let dailyGoal = parseInt(localStorage.getItem('dailyGoal')) || 5;
        let weeklyGoal = parseInt(localStorage.getItem('weeklyGoal')) || 200;
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
        let charts = {};
        let currentPage = 1;
        const itemsPerPage = 10;
        
        

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function init() {
            categories.forEach(cat => { if (!xpByCategory[cat]) xpByCategory[cat] = 0; });
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('chartData', JSON.stringify(chartData)); // Inicializar chartData no localStorage
            updateCategorySelect();
            updateCategoryCards();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            checkReset();
            document.getElementById('landing-page').style.display = 'flex';
            document.getElementById('xp-daily').value = xpDaily;
            document.getElementById('xp-weekly').value = xpWeekly;
            document.getElementById('xp-one-time').value = xpOneTime;
            document.getElementById('difficulty-easy').value = difficultyMultipliers.easy;
            document.getElementById('difficulty-medium').value = difficultyMultipliers.medium;
            document.getElementById('difficulty-hard').value = difficultyMultipliers.hard;
            document.getElementById('daily-goal').value = dailyGoal;
            document.getElementById('weekly-goal').value = weeklyGoal;
            document.querySelectorAll('.attribute-btn').forEach(btn => btn.addEventListener('click', toggleAttribute));
            document.getElementById('missions-grid').addEventListener('wheel', (e) => {
                e.preventDefault();
                document.getElementById('missions-grid').scrollBy({ top: Math.sign(e.deltaY) * 10, behavior: 'smooth' });
            });
            updateSaveSlots();
        }

        function toggleAttribute(event) {
            const btn = event.currentTarget;
            btn.classList.toggle('selected');
            console.log(`Botão de atributo ${btn.getAttribute('data-attribute')} clicado. Estado: ${btn.classList.contains('selected') ? 'selecionado' : 'não selecionado'}`);
        }

        function resetAttributeButtons() { document.querySelectorAll('.attribute-btn').forEach(btn => btn.classList.remove('selected')); }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

        function showSection(id) {
            ['landing-page', 'main-menu', 'tasks-container', 'score-container', 'settings-container', 'history-container', 'save-container'].forEach(sec => {
                const elem = document.getElementById(sec);
                if (elem) {
                    elem.style.display = 'none';
                    elem.classList.remove('visible');
                }
            });
            const target = document.getElementById(id);
            if (target) {
                target.style.display = id === 'landing-page' ? 'flex' : 'block';
                setTimeout(() => target.classList.add('visible'), 10);
                if (id === 'main-menu') {
                    document.getElementById('header').style.display = 'flex';
                    document.getElementById('xp-bar').style.display = 'block';
                }
                if (id === 'history-container') {showHistoryView('table')};
                if (id === 'score-container') { updateCategoryProgress(); updateCharts(); updateAttributeProgress(); }
                if (id === 'tasks-container') resetAttributeButtons();
            }
        }

        function showMenu() { showSection('main-menu'); }
        function showTasks() { showSection('tasks-container'); }
        function showScore() { showSection('score-container'); }
        function showSettings() { showSection('settings-container'); }
        function showHistory() {
            currentPage = 1; // Resetar a página ao abrir a aba
            showSection('history-container');
        }

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            document.querySelector('.theme-btn i').className = document.body.classList.contains('light-theme') ? 'fas fa-moon' : 'fas fa-sun';
            updateCharts();
        }

        function addTask() {
            const name = document.getElementById('task-name').value.trim();
            const category = document.getElementById('task-category').value;
            const type = document.getElementById('task-type').value;
            const difficulty = parseFloat(document.getElementById('task-difficulty').value);
            const attributes = Array.from(new Set(
                Array.from(document.querySelectorAll('#attribute-buttons .attribute-btn.selected'))
                    .map(btn => btn.getAttribute('data-attribute'))
            ));
        
            if (!name) return showToast('Insira o nome da task.');
            if (!category) return showToast('Selecione uma categoria.');
            if (attributes.length === 0) return showToast('Selecione pelo menos um atributo.');
        
            tasks.push({ 
                name, 
                category, 
                type: type === 'Diário' ? 'daily' : type === 'Semanal' ? 'weekly' : 'one-time', 
                difficulty, 
                attributes, 
                completed: false, 
                progress: 0,
                lastCompleted: null
            });
        
            localStorage.setItem('tasks', JSON.stringify(tasks));
            document.getElementById('task-name').value = '';
            resetAttributeButtons();
            updateTasksGrid();
            updateMissions('all');
            showToast('Task adicionada!');
        }

        function editTask(index, newName) {
            if (newName.trim()) {
                tasks[index].name = newName.trim();
                localStorage.setItem('tasks', JSON.stringify(tasks));
                updateTasksGrid();
                updateMissions('all');
                showToast('Task editada!');
            } else {
                showToast('Nome da task não pode ser vazio.');
            }
        }

        function deleteTask(index) {
            if (!confirm('Excluir esta task?')) return;
            tasks.splice(index, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateTasksGrid();
            updateMissions('all');
            showToast('Task excluída!');
        }

        function clearAllTasks() {
            if (!confirm('Tem certeza que deseja apagar todas as tasks cadastradas? Essa ação não pode ser desfeita.')) return;
            tasks = [];
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateTasksGrid();
            updateMissions('all');
            showToast('Todas as tasks foram apagadas!');
        }

        function cancelTask(index) {
            if (!confirm('Cancelar esta task?')) return;
            const task = tasks[index];
            if (task.type !== 'daily') return showToast('Apenas tasks diárias podem ser canceladas.');
            task.completed = true;
            task.lastCompleted = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            // Remover a linha que adiciona ao completedTasks
            // completedTasks.push({ ...task, type: 'Diário', completedDate: task.lastCompleted });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            updateMissions('all');
            updateTasksGrid();
            updateHistory();
            showToast('Task cancelada!');
        }

        function updateTasksGrid() {
            const grid = document.getElementById('tasks-grid');
            grid.innerHTML = '';
            const attributeIcons = {
                Força: 'fas fa-dumbbell',
                Inteligência: 'fas fa-brain',
                Vitalidade: 'fas fa-heart',
                Sabedoria: 'fas fa-book',
                Destreza: 'fas fa-running',
                Humor: 'fas fa-smile'
            };
            tasks.forEach((task, index) => {
                const displayType = task.type === 'daily' ? 'Diário' : task.type === 'weekly' ? 'Semanal' : 'Única';
                // Usar Set para garantir atributos únicos
                const uniqueAttributes = Array.from(new Set(task.attributes));
                const attributesHtml = uniqueAttributes.map(attr => {
                    if (attributeIcons[attr]) {
                        return `<i class="${attributeIcons[attr]}" title="${attr}"></i>`;
                    }
                    return ''; // Ignorar atributos inválidos
                }).join('');
                
                const card = document.createElement('div');
                card.className = 'task-card';
                card.innerHTML = `
                    <div class="task-content">
                        <span>${task.name} (${task.category} - ${displayType})</span>
                        <div class="attributes">${attributesHtml}</div>
                        <div class="icons">
                            <i class="fas fa-edit" onclick="showEditForm(${index})" title="Editar"></i>
                            <i class="fas fa-trash" onclick="deleteTask(${index})" title="Excluir"></i>
                        </div>
                    </div>
                    <div class="edit-form" id="edit-form-${index}" style="display: none;">
                        <input type="text" id="edit-task-name-${index}" value="${task.name}" placeholder="Nome da task">
                        <select id="edit-task-category-${index}">
                            ${categories.map(cat => `<option value="${cat}" ${task.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                        </select>
                        <select id="edit-task-type-${index}">
                            <option value="Diário" ${task.type === 'daily' ? 'selected' : ''}>Diário</option>
                            <option value="Semanal" ${task.type === 'weekly' ? 'selected' : ''}>Semanal</option>
                            <option value="Única" ${task.type === 'one-time' ? 'selected' : ''}>Única</option>
                        </select>
                        <select id="edit-task-difficulty-${index}">
                            <option value="1" ${task.difficulty === 1 ? 'selected' : ''}>Baixa</option>
                            <option value="1.5" ${task.difficulty === 1.5 ? 'selected' : ''}>Média</option>
                            <option value="2" ${task.difficulty === 2 ? 'selected' : ''}>Alta</option>
                        </select>
                        <div class="attribute-buttons">
                            ${Object.keys(attributeIcons).map(attr => `
                                <button type="button" class="attribute-btn ${task.attributes.includes(attr) ? 'selected' : ''}" data-attribute="${attr}">
                                    <i class="${attributeIcons[attr]}"></i> ${attr}
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="saveTaskEdit(${index})">Salvar</button>
                        <button class="cancel-btn" onclick="cancelTaskEdit(${index})">Cancelar</button>
                    </div>
                `;
                grid.appendChild(card);
                // Adicionar eventos de clique aos botões de atributos no formulário de edição
                card.querySelectorAll('.edit-form .attribute-btn').forEach(btn => {
                    const newBtn = btn.cloneNode(true); // Clonar para evitar eventos duplicados
                    btn.parentNode.replaceChild(newBtn, btn);
                    newBtn.addEventListener('click', toggleAttribute);
                });
            });
        }


        function showEditForm(index) {
            // Ocultar todos os formulários de edição e mostrar conteúdos
            document.querySelectorAll('.edit-form').forEach(form => form.style.display = 'none');
            document.querySelectorAll('.task-content').forEach(content => content.style.display = 'block');
            document.querySelectorAll('.task-card').forEach(card => card.classList.remove('edit-mode'));
        
            // Mostrar o formulário de edição do card clicado
            const form = document.getElementById(`edit-form-${index}`);
            const content = document.querySelectorAll('.task-content')[index];
            const card = form.closest('.task-card');
            if (!form || !content || !card) {
                console.error(`Erro: Elementos não encontrados para index ${index}`);
                showToast('Erro ao abrir formulário de edição.');
                return;
            }
            form.style.display = 'flex';
            content.style.display = 'none';
            card.classList.add('edit-mode');
        
            // Limpar eventos antigos e adicionar novos aos botões de atributos
            const attributeButtons = form.querySelectorAll('.attribute-btn');
            attributeButtons.forEach(btn => {
                const attribute = btn.getAttribute('data-attribute');
                const isSelected = tasks[index].attributes.includes(attribute);
                btn.classList.toggle('selected', isSelected); // Garantir estado correto
                const newBtn = btn.cloneNode(true); // Clonar para evitar eventos duplicados
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', toggleAttribute);
            });
        }
        
        function saveTaskEdit(index) {
            try {
                const nameInput = document.getElementById(`edit-task-name-${index}`);
                const categoryInput = document.getElementById(`edit-task-category-${index}`);
                const typeInput = document.getElementById(`edit-task-type-${index}`);
                const difficultyInput = document.getElementById(`edit-task-difficulty-${index}`);
                const form = document.getElementById(`edit-form-${index}`);
        
                if (!nameInput || !categoryInput || !typeInput || !difficultyInput || !form) {
                    console.error(`Erro: Elementos do formulário não encontrados para index ${index}`);
                    showToast('Erro ao salvar: formulário inválido.');
                    return;
                }
        
                const name = nameInput.value.trim();
                const category = categoryInput.value;
                const typeDisplay = typeInput.value;
                const difficulty = parseFloat(difficultyInput.value);
                const selectedButtons = form.querySelectorAll('.attribute-buttons .attribute-btn.selected');
                const attributes = Array.from(new Set(
                    Array.from(selectedButtons).map(btn => btn.getAttribute('data-attribute'))
                ));
        
                // Validações
                if (!name) {
                    showToast('Insira o nome da task.');
                    return;
                }
                if (!category) {
                    showToast('Selecione uma categoria.');
                    return;
                }
                if (attributes.length === 0) {
                    showToast('Selecione pelo menos um atributo.');
                    return;
                }
                if (isNaN(difficulty)) {
                    showToast('Selecione uma dificuldade válida.');
                    return;
                }
        
                // Atualizar a tarefa
                tasks[index] = {
                    ...tasks[index],
                    name,
                    category,
                    type: typeDisplay === 'Diário' ? 'daily' : typeDisplay === 'Semanal' ? 'weekly' : 'one-time',
                    difficulty,
                    attributes
                };
        
                // Salvar no localStorage
                localStorage.setItem('tasks', JSON.stringify(tasks));
        
                // Atualizar a interface
                updateTasksGrid();
                updateMissions(currentCategory);
                cancelTaskEdit(index); // Fechar o formulário
                showToast('Task editada com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar tarefa:', error);
                showToast('Erro ao salvar tarefa. Veja o console para detalhes.');
            }
        }
     
        function showSave() {
            try {
                // Usar a função showSection para exibir a seção correta
                showSection('save-container');
                
                // Atualizar os slots de salvamento
                updateSaveSlots();
                
                console.log('Aba de Salvar/Carregar aberta com sucesso.');
                showToast('Aba de Salvar/Carregar aberta.');
            } catch (error) {
                console.error('Erro ao abrir aba de Salvar/Carregar:', error);
                showToast('Erro ao abrir aba de Salvar/Carregar. Veja o console para detalhes.');
            }
        }
        
        function cancelTaskEdit(index) {
            const form = document.getElementById(`edit-form-${index}`);
            const content = document.querySelectorAll('.task-content')[index];
            const card = form.closest('.task-card');
            form.style.display = 'none';
            content.style.display = 'block';
            card.classList.remove('edit-mode');
        }

        function addCategory() {
            const newCategory = document.getElementById('new-category').value.trim();
            if (newCategory && !categories.includes(newCategory)) {
                categories.push(newCategory);
                xpByCategory[newCategory] = 0;
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
                document.getElementById('new-category').value = '';
                updateCategoryCards();
                updateCategorySelect();
                updateCategoryProgress();
                showToast('Categoria adicionada!');
            } else {
                showToast('Categoria inválida ou já existe.');
            }
        }

        function editCategory(oldCat, newCat) {
            const index = categories.indexOf(oldCat);
            if (index !== -1 && newCat.trim() && !categories.includes(newCat)) {
                categories[index] = newCat;
                xpByCategory[newCat] = xpByCategory[oldCat] || 0;
                delete xpByCategory[oldCat];
                tasks.forEach(task => { if (task.category === oldCat) task.category = newCat; });
                completedTasks.forEach(task => { if (task.category === oldCat) task.category = newCat; });
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
                updateCategoryCards();
                updateCategorySelect();
                updateHistory();
                updateCategoryProgress();
                showToast('Categoria editada!');
            } else {
                showToast('Categoria inválida ou já existe.');
            }
        }

        function deleteCategory(cat) {
            if (!confirm(`Excluir a categoria "${cat}"? Todas as tasks associadas serão removidas.`)) return;
            categories = categories.filter(c => c !== cat);
            delete xpByCategory[cat];
            tasks = tasks.filter(task => task.category !== cat);
            completedTasks = completedTasks.filter(task => task.category !== cat);
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            updateCategoryCards();
            updateCategorySelect();
            updateHistory();
            updateCategoryProgress();
            showToast('Categoria excluída!');
        }

        function updateCategoryCards() {
            const cards = document.getElementById('category-cards');
            cards.innerHTML = '';
            categories.forEach(cat => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<input type="text" value="${cat}" onchange="editCategory('${cat}', this.value)"><i class="fas fa-trash" onclick="deleteCategory('${cat}')"></i>`;
                cards.appendChild(card);
            });
        }

        function updateCategorySelect() {
            const select = document.getElementById('task-category');
            const catSelect = document.getElementById('category-select');
            select.innerHTML = '';
            catSelect.innerHTML = '';
            const allBtn = document.createElement('button');
            allBtn.className = 'start-mission-btn';
            allBtn.textContent = 'Todas';
            allBtn.onclick = () => updateMissions('all');
            catSelect.appendChild(allBtn);
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
                const btn = document.createElement('button');
                btn.className = 'start-mission-btn';
                btn.textContent = cat;
                btn.onclick = () => updateMissions(cat);
                catSelect.appendChild(btn);
            });
        }

        function updateMissions(category) {
            currentCategory = category;
            const grid = document.getElementById('missions-grid');
            grid.innerHTML = '';
            let filteredTasks = tasks.filter(task => !task.completed);
            if (category !== 'all') filteredTasks = filteredTasks.filter(task => task.category === category);
            const attributeIcons = {
                Força: 'fas fa-dumbbell',
                Inteligência: 'fas fa-brain',
                Vitalidade: 'fas fa-heart',
                Sabedoria: 'fas fa-book',
                Destreza: 'fas fa-running',
                Humor: 'fas fa-smile'
            };
            filteredTasks.forEach((task, index) => {
                const taskIndex = tasks.indexOf(task);
                const displayType = task.type === 'daily' ? 'Diário' : task.type === 'weekly' ? 'Semanal' : 'Única';
                const uniqueAttributes = Array.from(new Set(task.attributes)); // Garantir atributos únicos
                const attributesHtml = uniqueAttributes.map(attr => {
                    if (attributeIcons[attr]) {
                        return `<i class="${attributeIcons[attr]}" title="${attr}"></i>`;
                    }
                    return ''; // Ignorar atributos inválidos
                }).join('');
                const card = document.createElement('div');
                card.className = 'mission-card';
                card.innerHTML = `
                    <h3>${task.name}</h3>
                    <p>${task.category} - ${displayType}</p>
                    <div class="attributes">${attributesHtml}</div>
                    <div class="task-progress">
                        <input type="range" min="0" max="100" value="${task.progress}" step="10" oninput="this.style.setProperty('--value', this.value + '%')" onchange="updatePartialXP(${taskIndex}, this.value)">
                        <span>${task.progress}%</span>
                    </div>
                    <div class="task-actions">
                        <button onclick="confirmToggleTask(${taskIndex})" ${task.progress < 10 ? 'disabled' : ''}>Completar</button>
                        ${task.type === 'daily' ? `<button class="cancel-btn" onclick="cancelTask(${taskIndex})">Cancelar</button>` : ''}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        const debouncedUpdatePartialXP = debounce((index, value) => {
            tasks[index].progress = parseInt(value);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateMissions(currentCategory);
            const button = document.querySelectorAll('.mission-card')[tasks.indexOf(tasks[index])].querySelector('button');
            button.disabled = parseInt(value) < 10;
        }, 100);

        function updatePartialXP(index, value) { debouncedUpdatePartialXP(index, value); }

        function confirmToggleTask(index) {
            if (!confirm('Completar esta task?')) return;
            toggleTask(index);
        }

        function toggleTask(index) {
            const task = tasks[index];
            if (task.completed) return showToast('Task já concluída.');
            if (task.progress < 10) return showToast('Task não pode ficar abaixo de 10%');
            const displayType = task.type === 'daily' ? 'Diário' : task.type === 'weekly' ? 'Semanal' : 'Única';
            const basePoints = task.type === 'daily' ? xpDaily : task.type === 'weekly' ? xpWeekly : xpOneTime;
            const multiplier = task.difficulty === 1 ? difficultyMultipliers.easy : task.difficulty === 1.5 ? difficultyMultipliers.medium : difficultyMultipliers.hard;
            const progressFactor = task.progress / 100; 
            const points = Math.round(basePoints * multiplier * progressFactor * (1 + streak * 0.05));
            
            // Adicionar a completedTasks para a tabela de histórico
            completedTasks.push({ ...task, type: displayType, completedDate: new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }), points });
            // Adicionar a chartData para os gráficos
            chartData.push({ ...task, type: displayType, completedDate: new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' }) });
            xp += points;
            xpByCategory[task.category] = (xpByCategory[task.category] || 0) + points;
            const pointsPerAttribute = task.attributes.length > 0 ? Math.floor(points / task.attributes.length) : 0;
            task.attributes.forEach(attr => { attributesPoints[attr] = (attributesPoints[attr] || 0) + pointsPerAttribute; });
            const today = new Date();
            const dayIndex = today.getDay();
            xpHistory[dayIndex] = (xpHistory[dayIndex] || 0) + points;
            if (task.type === 'daily') {
                dailyCount++;
                task.completed = true;
                task.lastCompleted = today.toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            } else if (task.type === 'weekly') {
                task.completed = true;
            } else {
                tasks.splice(index, 1);
            }
            if (Math.floor(xp / 100) + 1 > level) {
                level = Math.floor(xp / 100) + 1;
                showToast(`Parabéns! Nível ${level}!`);
            }
            localStorage.setItem('xp', xp);
            localStorage.setItem('dailyCount', dailyCount);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('chartData', JSON.stringify(chartData)); // Salvar chartData no localStorage
            showToast(`+${points} XP!`);
            updateMissions(currentCategory);
            updateTasksGrid();
            updateScore();
            updateHistory();
        }

        function updateScore() {
            document.getElementById('xp').textContent = Math.floor(xp);
            document.getElementById('level').textContent = level;
            document.getElementById('streak').textContent = streak;
            document.getElementById('daily-progress').max = dailyGoal;
            document.getElementById('daily-progress').value = dailyCount;
            document.getElementById('weekly-progress').max = weeklyGoal;
            document.getElementById('weekly-progress').value = Math.floor(xp % weeklyGoal);
            document.getElementById('daily-goal-label').textContent = dailyGoal;
            document.getElementById('weekly-goal-label').textContent = weeklyGoal;
            document.getElementById('global-xp').value = Math.floor(xp % 100);
            document.getElementById('xp-label').textContent = `XP: ${xp % 100} / 100 (Nível ${level})`;
            updateCategoryProgress();
            updateAttributeProgress();
            updateCharts();
        }

        function updateCategoryProgress() {
            const grid = document.getElementById('category-progress');
            grid.innerHTML = '';
            categories.forEach(cat => { if (!xpByCategory[cat]) xpByCategory[cat] = 0; });
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            categories.forEach(cat => {
                const xp = Math.floor(xpByCategory[cat] || 0);
                const level = Math.floor(xp / 100) + 1;
                const progress = Math.floor(xp % 100);
                const card = document.createElement('div');
                card.className = 'category-progress-card';
                card.innerHTML = `<h4>${cat}</h4><p>Nível: ${level}</p><p>XP: ${xp} (${progress}/100)</p><progress value="${progress}" max="100"></progress>`;
                grid.appendChild(card);
            });
        }

        function updateAttributeProgress() {
            const grid = document.getElementById('attribute-progress');
            grid.innerHTML = '';
            const attributeIcons = { Força: 'fas fa-dumbbell', Inteligência: 'fas fa-brain', Vitalidade: 'fas fa-heart', Sabedoria: 'fas fa-book', Destreza: 'fas fa-running', Humor: 'fas fa-smile' };
            Object.keys(attributesPoints).forEach(attr => {
                const xp = Math.floor(attributesPoints[attr] || 0);
                const level = Math.floor(xp / 100) + 1;
                const progress = Math.floor(xp % 100);
                const card = document.createElement('div');
                card.className = 'attribute-progress-card';
                card.innerHTML = `<h4><i class="${attributeIcons[attr]}"></i> ${attr}</h4><p>Nível: ${level}</p><p>XP: ${xp} (${progress}/100)</p><progress value="${progress}" max="100"></progress>`;
                grid.appendChild(card);
            });
        }

        function updateHistory() {
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';
            
            // Calcular o número total de páginas
            const totalPages = Math.ceil(completedTasks.length / itemsPerPage);
            
            // Garantir que currentPage esteja dentro dos limites
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            // Filtrar tarefas para a página atual
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedTasks = completedTasks.slice(startIndex, endIndex);
            
            // Preencher a tabela com as tarefas da página atual
            paginatedTasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${task.name}</td><td>${task.category}</td><td>${task.type}</td><td>${task.progress}%</td><td>${task.completedDate}</td>`;
                tableBody.appendChild(row);
            });
            
            // Atualizar os controles de paginação
            updatePaginationControls(totalPages);
        }
        
        function updatePaginationControls(totalPages) {
            const paginationContainer = document.getElementById('pagination-controls');
            paginationContainer.innerHTML = '';
            
            // Botão "Início"
            const firstBtn = document.createElement('button');
            firstBtn.className = 'pagination-btn';
            firstBtn.innerHTML = '<i class="fas fa-angle-double-left"></i>';
            firstBtn.title = 'Primeira Página';
            firstBtn.disabled = currentPage === 1;
            firstBtn.onclick = () => {
                currentPage = 1;
                updateHistory();
            };
            paginationContainer.appendChild(firstBtn);
            
            // Calcular quais números de página exibir (máximo de 5 botões)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // Adicionar botões de página
            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => {
                    currentPage = i;
                    updateHistory();
                };
                paginationContainer.appendChild(btn);
            }
            
            // Botão "Fim"
            const lastBtn = document.createElement('button');
            lastBtn.className = 'pagination-btn';
            lastBtn.innerHTML = '<i class="fas fa-angle-double-right"></i>';
            lastBtn.title = 'Última Página';
            lastBtn.disabled = currentPage === totalPages;
            lastBtn.onclick = () => {
                currentPage = totalPages;
                updateHistory();
            };
            paginationContainer.appendChild(lastBtn);
        }

        function saveSettings() {
            xpDaily = parseInt(document.getElementById('xp-daily').value) || 10;
            xpWeekly = parseInt(document.getElementById('xp-weekly').value) || 50;
            xpOneTime = parseInt(document.getElementById('xp-one-time').value) || 20;
            difficultyMultipliers.easy = parseFloat(document.getElementById('difficulty-easy').value) || 1;
            difficultyMultipliers.medium = parseFloat(document.getElementById('difficulty-medium').value) || 1.5;
            difficultyMultipliers.hard = parseFloat(document.getElementById('difficulty-hard').value) || 2;
            dailyGoal = parseInt(document.getElementById('daily-goal').value) || 5;
            weeklyGoal = parseInt(document.getElementById('weekly-goal').value) || 200;
            localStorage.setItem('xpDaily', xpDaily);
            localStorage.setItem('xpWeekly', xpWeekly);
            localStorage.setItem('xpOneTime', xpOneTime);
            localStorage.setItem('difficultyMultipliers', JSON.stringify(difficultyMultipliers));
            localStorage.setItem('dailyGoal', dailyGoal);
            localStorage.setItem('weeklyGoal', weeklyGoal);
            updateScore();
            showToast('Configurações salvas!');
        }

        function resetAll() {
            if (!confirm('Resetar todo o progresso? Isso não pode be desfeito.')) return;
            
            // Resetar variáveis de progresso
            xp = 0;
            level = 1;
            dailyCount = 0;
            streak = 0;
            lastReset = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            lastWeeklyReset = lastReset;
            xpHistory = Array(7).fill(0);
            xpByCategory = {};
            attributesPoints = { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
            completedTasks = [];
            chartData = []; // Resetar chartData
        
            // Resetar progresso das tarefas existentes (mantendo as tarefas)
            tasks = tasks.map(task => ({
                ...task,
                completed: false,
                progress: 0,
                lastCompleted: null
            }));
        
            // Inicializar xpByCategory para todas as categorias existentes
            categories.forEach(cat => { xpByCategory[cat] = 0; });
        
            // Salvar no localStorage
            localStorage.setItem('xp', xp);
            localStorage.setItem('level', level);
            localStorage.setItem('dailyCount', dailyCount);
            localStorage.setItem('streak', streak);
            localStorage.setItem('lastReset', lastReset);
            localStorage.setItem('lastWeeklyReset', lastWeeklyReset);
            localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('chartData', JSON.stringify(chartData)); // Salvar chartData
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('xpDaily', xpDaily);
            localStorage.setItem('xpWeekly', xpWeekly);
            localStorage.setItem('xpOneTime', xpOneTime);
            localStorage.setItem('difficultyMultipliers', JSON.stringify(difficultyMultipliers));
            localStorage.setItem('dailyGoal', dailyGoal);
            localStorage.setItem('weeklyGoal', weeklyGoal);
        
            // Atualizar a interface
            updateCategorySelect();
            updateCategoryCards();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            showToast('Progresso resetado!');
        }


        function deleteAllData() {
            if (!confirm('Tem certeza que deseja apagar TODOS os dados? Isso inclui todos os slots de salvamento, tarefas, histórico e configurações. Essa ação não pode ser desfeita.')) return;
        
            // Limpar todas as chaves do localStorage relacionadas ao aplicativo
            localStorage.clear(); // Remove todas as chaves, mas vamos garantir que apenas as relevantes sejam afetadas
        
            // Reiniciar variáveis globais
            tasks = [];
            categories = ['Saúde', 'Trabalho', 'Aprendizado', 'Lazer'];
            xp = 0;
            level = 1;
            dailyCount = 0;
            streak = 0;
            lastReset = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            lastWeeklyReset = lastReset;
            xpHistory = Array(7).fill(0);
            xpByCategory = {};
            attributesPoints = { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
            xpDaily = 10;
            xpWeekly = 50;
            xpOneTime = 20;
            difficultyMultipliers = { easy: 1, medium: 1.5, hard: 2 };
            dailyGoal = 5;
            weeklyGoal = 200;
            completedTasks = [];
            chartData = [];
        
            // Inicializar xpByCategory para categorias padrão
            categories.forEach(cat => { xpByCategory[cat] = 0; });
        
            // Salvar valores padrão no localStorage
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('xp', xp);
            localStorage.setItem('level', level);
            localStorage.setItem('dailyCount', dailyCount);
            localStorage.setItem('streak', streak);
            localStorage.setItem('lastReset', lastReset);
            localStorage.setItem('lastWeeklyReset', lastWeeklyReset);
            localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            localStorage.setItem('xpDaily', xpDaily);
            localStorage.setItem('xpWeekly', xpWeekly);
            localStorage.setItem('xpOneTime', xpOneTime);
            localStorage.setItem('difficultyMultipliers', JSON.stringify(difficultyMultipliers));
            localStorage.setItem('dailyGoal', dailyGoal);
            localStorage.setItem('weeklyGoal', weeklyGoal);
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('chartData', JSON.stringify(chartData));
        
            // Remover todos os slots de salvamento
            for (let i = 0; i < 10; i++) {
                localStorage.removeItem(`saveSlot${i}`);
            }
        
            // Atualizar a interface
            updateCategorySelect();
            updateCategoryCards();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            updateSaveSlots();
            showToast('Todos os dados foram apagados!');
        }


        function checkReset() {
            const today = new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            const lastResetDate = new Date(lastReset);
            const todayDate = new Date(today);
            const diffDays = Math.floor((todayDate - lastResetDate) / (1000 * 60 * 60 * 24));
            if (diffDays >= 1) {
                tasks.forEach(task => {
                    if (task.type === 'daily' && task.completed && task.lastCompleted !== today) {
                        task.completed = false;
                        task.progress = 0;
                    }
                });
                dailyCount = 0;
                streak = diffDays === 1 && tasks.some(task => task.type === 'daily' && task.completed) ? streak + 1 : 0;
                lastReset = today;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('dailyCount', dailyCount);
                localStorage.setItem('streak', streak);
                localStorage.setItem('lastReset', lastReset);
            }
            const lastWeeklyResetDate = new Date(lastWeeklyReset);
            const diffWeeks = Math.floor((todayDate - lastWeeklyResetDate) / (1000 * 60 * 60 * 24 * 7));
            if (diffWeeks >= 1) {
                tasks.forEach(task => {
                    if (task.type === 'weekly') {
                        task.completed = false;
                        task.progress = 0;
                    }
                });
                lastWeeklyReset = today;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('lastWeeklyReset', lastWeeklyReset);
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function updateCharts() {
            const isLightTheme = document.body.classList.contains('light-theme');
            const backgroundColor = isLightTheme ? 'rgba(66, 165, 245, 0.5)' : 'rgba(171, 71, 188, 0.5)';
            const borderColor = isLightTheme ? '#007bff' : '#ab47bc';
            const fontColor = isLightTheme ? '#333' : '#ffffff';
            if (charts.xpChartBar) charts.xpChartBar.destroy();
            charts.xpChartBar = new Chart(document.getElementById('xp-chart-bar'), {
                type: 'bar',
                data: { labels: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'], datasets: [{ label: 'XP Semanal', data: xpHistory, backgroundColor, borderColor, borderWidth: 1 }] },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { color: fontColor } },
                        x: { ticks: { color: fontColor } }
                    },
                    plugins: { legend: { labels: { color: fontColor } } }
                }
            });
            const monthlyTasks = Array(30).fill(0);
            const yearlyTasks = Array(12).fill(0);
            const today = new Date();
            const currentYear = today.getFullYear();
            chartData.forEach(task => { // Alterado de completedTasks para chartData
                const taskDate = new Date(task.completedDate.split('/').reverse().join('-'));
                const diffDays = Math.floor((today - taskDate) / (1000 * 60 * 60 * 24));
                if (diffDays < 30) monthlyTasks[29 - diffDays]++;
                const taskYear = taskDate.getFullYear();
                const taskMonth = taskDate.getMonth();
                if (taskYear === currentYear) {
                    yearlyTasks[taskMonth]++;
                } else if (taskYear === currentYear - 1) {
                    const monthsDiff = 12 - taskDate.getMonth() + today.getMonth();
                    if (monthsDiff < 12) {
                        yearlyTasks[taskMonth]++;
                    }
                }
            });
            if (charts.tasksChartMonthly) charts.tasksChartMonthly.destroy();
            charts.tasksChartMonthly = new Chart(document.getElementById('tasks-chart-monthly'), {
                type: 'line',
                data: { labels: Array.from({ length: 30 }, (_, i) => `${29 - i} dias atrás`), datasets: [{ label: 'Tasks Concluídas (Mensal)', data: monthlyTasks, backgroundColor, borderColor, fill: false, tension: 0.1 }] },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { color: fontColor } },
                        x: { ticks: { color: fontColor } }
                    },
                    plugins: { legend: { labels: { color: fontColor } } }
                }
            });
            if (charts.tasksChartYearly) charts.tasksChartYearly.destroy();
            charts.tasksChartYearly = new Chart(document.getElementById('tasks-chart-yearly'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [{ label: 'Tasks Concluídas (Anual)', data: yearlyTasks, backgroundColor, borderColor, borderWidth: 1 }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, ticks: { color: fontColor } },
                        x: { ticks: { color: fontColor } }
                    },
                    plugins: { legend: { labels: { color: fontColor } } }
                }
            });
            if (charts.xpChartRadar) charts.xpChartRadar.destroy();
            charts.xpChartRadar = new Chart(document.getElementById('xp-chart-radar'), {
                type: 'radar',
                data: { 
                    labels: categories, 
                    datasets: [{ 
                        label: 'XP por Categoria', 
                        data: categories.map(cat => Math.floor(xpByCategory[cat] || 0)), 
                        backgroundColor: 'transparent', 
                        borderColor, 
                        borderWidth: 1 
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { color: fontColor, backdropColor: 'transparent' },
                            pointLabels: { color: fontColor },
                            grid: { color: isLightTheme ? '#ccc' : '#555' },
                            angleLines: { color: isLightTheme ? '#ccc' : '#555' }
                        }
                    },
                    plugins: { legend: { labels: { color: fontColor } } }
                }
            });
            if (charts.attributeChartRadar) charts.attributeChartRadar.destroy();
            charts.attributeChartRadar = new Chart(document.getElementById('attribute-chart-radar'), {
                type: 'radar',
                data: { 
                    labels: Object.keys(attributesPoints), 
                    datasets: [{ 
                        label: 'XP por Atributo', 
                        data: Object.values(attributesPoints).map(x => Math.floor(x)), 
                        backgroundColor: 'transparent', 
                        borderColor, 
                        borderWidth: 1 
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { color: fontColor, backdropColor: 'transparent' },
                            pointLabels: { color: fontColor },
                            grid: { color: isLightTheme ? '#ccc' : '#555' },
                            angleLines: { color: isLightTheme ? '#ccc' : '#555' }
                        }
                    },
                    plugins: { legend: { labels: { color: fontColor } } }
                }
            });
            if (charts.xpChartRadar) charts.xpChartRadar.destroy();
            charts.xpChartRadar = new Chart(document.getElementById('xp-chart-radar'), {
                type: 'radar',
                data: { 
                    labels: categories, 
                    datasets: [{ 
                        label: 'XP por Categoria', 
                        data: categories.map(cat => Math.floor(xpByCategory[cat] || 0)), 
                        backgroundColor: 'transparent', 
                        borderColor, 
                        borderWidth: 1 
                    }]
                },
                options: {
                  scales: {
                      r: {
                          beginAtZero: true,
                          ticks: { color: fontColor, backdropColor: 'transparent' }, // Cor da fonte dos ticks e fundo transparente
                          pointLabels: { color: fontColor }, // Cor das labels dos pontos (categorias)
                          grid: { color: isLightTheme ? '#ccc' : '#555' }, // Cor da grade
                          angleLines: { color: isLightTheme ? '#ccc' : '#555' } // Cor das linhas angulares
                      }
                  },
                  plugins: {
                      legend: {
                          labels: { color: fontColor } // Cor da fonte da legenda
                      }
                  }
              }
            });
            if (charts.attributeChartRadar) charts.attributeChartRadar.destroy();
            charts.attributeChartRadar = new Chart(document.getElementById('attribute-chart-radar'), {
                type: 'radar',
                data: { 
                    labels: Object.keys(attributesPoints), 
                    datasets: [{ 
                        label: 'XP por Atributo', 
                        data: Object.values(attributesPoints).map(x => Math.floor(x)), 
                        backgroundColor: 'transparent', 
                        borderColor, 
                        borderWidth: 1 
                    }]
                },
                options: {
                  scales: {
                      r: {
                          beginAtZero: true,
                          ticks: { color: fontColor, backdropColor: 'transparent' }, // Cor da fonte dos ticks e fundo transparente
                          pointLabels: { color: fontColor }, // Cor das labels dos pontos (atributos)
                          grid: { color: isLightTheme ? '#ccc' : '#555' }, // Cor da grade
                          angleLines: { color: isLightTheme ? '#ccc' : '#555' } // Cor das linhas angulares
                      }
                  },
                  plugins: {
                      legend: {
                          labels: { color: fontColor } // Cor da fonte da legenda
                      }
                  }
              }
            });
        }
        function clearHistory() {
            if (!confirm('Tem certeza que deseja apagar todo o histórico? Essa ação não pode ser desfeita.')) return;
            completedTasks = [];
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            currentPage = 1; // Resetar a página atual
            if (currentHistoryView === 'table') {
                updateHistory();
            } else {
                updateTaskTotals();
            }
            showToast('Histórico apagado!');
        }
        
        function updateSaveSlots() {
            const grid = document.getElementById('save-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const slotData = JSON.parse(localStorage.getItem(`saveSlot${i}`)) || null;
                const card = document.createElement('div');
                card.className = 'save-card';
                if (slotData) {
                    const date = new Date(slotData.timestamp).toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
                    card.innerHTML = `
                        <h4>Slot ${i + 1}</h4>
                        <p>Data: ${date}</p>
                        <p>XP: ${slotData.xp}</p>
                        <p>Nível: ${slotData.level}</p>
                        <div class="icons">
                            <i class="fas fa-trash" onclick="deleteSaveSlot(${i})" title="Apagar Slot"></i>
                        </div>
                        <div class="task-actions">
                            <button onclick="saveToSlot(${i})">Salvar</button>
                            <button class="load-btn" onclick="loadFromSlot(${i})">Carregar</button>
                        </div>
                    `;
                } else {
                    card.innerHTML = `
                        <h4>Slot ${i + 1}</h4>
                        <p>Vazio</p>
                        <div class="task-actions">
                            <button onclick="saveToSlot(${i})">Salvar</button>
                        </div>
                    `;
                }
                grid.appendChild(card);
            }
        }
        
        let pendingSlot = null; // Variável para armazenar o slot pendente
        
        function saveToSlot(slot) {
            pendingSlot = slot; // Armazenar o slot clicado
            const slotData = JSON.parse(localStorage.getItem(`saveSlot${slot}`)) || null;
            const dialog = document.getElementById('confirmation-dialog');
            const slotNumberDisplay = document.getElementById('slot-number');
            slotNumberDisplay.textContent = slot + 1;
            dialog.style.display = 'flex';
        }
        
        function confirmSave() {
            if (pendingSlot === null) return;
            const slotName = `saveSlot${pendingSlot}`;
            const saveData = {
                timestamp: new Date().toISOString(),
                tasks,
                categories,
                xp,
                level,
                dailyCount,
                streak,
                lastReset,
                lastWeeklyReset,
                xpHistory,
                xpByCategory,
                attributesPoints,
                xpDaily,
                xpWeekly,
                xpOneTime,
                difficultyMultipliers,
                dailyGoal,
                weeklyGoal,
                completedTasks,
                chartData
            };
            localStorage.setItem(slotName, JSON.stringify(saveData));
            updateSaveSlots();
            showToast(`Jogo salvo no Slot ${pendingSlot + 1}!`);
            cancelSave(); // Fechar o diálogo após salvar
        }
        
        function cancelSave() {
            const dialog = document.getElementById('confirmation-dialog');
            dialog.style.display = 'none';
            pendingSlot = null; // Resetar o slot pendente
        }
        
        function loadFromSlot(slot) {
            if (!confirm(`Carregar o jogo do Slot ${slot + 1}? Isso substituirá todos os dados atuais.`)) return;
            const slotName = `saveSlot${slot}`;
            const saveData = JSON.parse(localStorage.getItem(slotName));
            if (!saveData) {
                showToast(`Slot ${slot + 1} está vazio!`);
                return;
            }
            tasks = saveData.tasks || [];
            categories = saveData.categories || ['Saúde', 'Trabalho', 'Aprendizado', 'Lazer'];
            xp = saveData.xp || 0;
            level = saveData.level || 1;
            dailyCount = saveData.dailyCount || 0;
            streak = saveData.streak || 0;
            lastReset = saveData.lastReset || new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            lastWeeklyReset = saveData.lastWeeklyReset || new Date().toLocaleDateString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            xpHistory = saveData.xpHistory || Array(7).fill(0);
            xpByCategory = saveData.xpByCategory || {};
            attributesPoints = saveData.attributesPoints || { Força: 0, Inteligência: 0, Vitalidade: 0, Sabedoria: 0, Destreza: 0, Humor: 0 };
            xpDaily = saveData.xpDaily || 10;
            xpWeekly = saveData.xpWeekly || 50;
            xpOneTime = saveData.xpOneTime || 20;
            difficultyMultipliers = saveData.difficultyMultipliers || { easy: 1, medium: 1.5, hard: 2 };
            dailyGoal = saveData.dailyGoal || 5;
            weeklyGoal = saveData.weeklyGoal || 200;
            completedTasks = saveData.completedTasks || [];
            chartData = saveData.chartData || [];
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('xp', xp);
            localStorage.setItem('level', level);
            localStorage.setItem('dailyCount', dailyCount);
            localStorage.setItem('streak', streak);
            localStorage.setItem('lastReset', lastReset);
            localStorage.setItem('lastWeeklyReset', lastWeeklyReset);
            localStorage.setItem('xpHistory', JSON.stringify(xpHistory));
            localStorage.setItem('xpByCategory', JSON.stringify(xpByCategory));
            localStorage.setItem('attributesPoints', JSON.stringify(attributesPoints));
            localStorage.setItem('xpDaily', xpDaily);
            localStorage.setItem('xpWeekly', xpWeekly);
            localStorage.setItem('xpOneTime', xpOneTime);
            localStorage.setItem('difficultyMultipliers', JSON.stringify(difficultyMultipliers));
            localStorage.setItem('dailyGoal', dailyGoal);
            localStorage.setItem('weeklyGoal', weeklyGoal);
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('chartData', JSON.stringify(chartData));
            updateCategorySelect();
            updateCategoryCards();
            updateTasksGrid();
            updateMissions('all');
            updateScore();
            updateHistory();
            updateSaveSlots();
            showToast(`Jogo carregado do Slot ${slot + 1}!`);
        }
        
        function deleteSaveSlot(slot) {
            if (!confirm(`Apagar o Slot ${slot + 1}? Essa ação não pode ser desfeita.`)) return;
            localStorage.removeItem(`saveSlot${slot}`); // Corrigido de `i` para `slot`
            updateSaveSlots();
            showToast(`Slot ${slot + 1} apagado!`);
        }
        let currentHistoryView = 'table';
        let currentFilter = 'repetitivo';

        function exportSaveData() {
            const saveData = {};
            for (let i = 0; i < 10; i++) {
                const slotData = JSON.parse(localStorage.getItem(`saveSlot${i}`)) || null;
                saveData[`slot${i}`] = slotData;
            }
            const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'save.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Dados exportados com sucesso!');
        }
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            const fileNameDisplay = document.getElementById('file-name');
            const submitButton = document.getElementById('submit-file');
            if (file) {
                fileNameDisplay.textContent = file.name;
                submitButton.style.display = 'flex';
            } else {
                fileNameDisplay.textContent = 'Nenhum arquivo selecionado';
                submitButton.style.display = 'none';
            }
        }

        function importSaveData() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            if (!file) {
                showToast('Nenhum arquivo selecionado!');
                return;
            }
            if (!confirm('Importar dados substituirá todos os slots existentes. Deseja continuar?')) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (!e.target.result) {
                        showToast('Erro ao importar dados: arquivo vazio!');
                        return;
                    }
                    const saveData = JSON.parse(e.target.result);
                    if (typeof saveData !== 'object' || saveData === null) {
                        showToast('Erro ao importar dados: formato inválido, esperado um objeto JSON!');
                        return;
                    }
                    // Verificar se o arquivo contém pelo menos um slot válido
                    let hasValidSlot = false;
                    for (let i = 0; i < 10; i++) {
                        const slotKey = `slot${i}`;
                        const slotData = saveData[slotKey] || null;
                        if (slotData) {
                            // Validar se slotData tem a estrutura esperada
                            if (typeof slotData !== 'object' || slotData === null) {
                                console.warn(`Slot ${i} inválido:`, slotData);
                                continue;
                            }
                            localStorage.setItem(`saveSlot${i}`, JSON.stringify(slotData));
                            hasValidSlot = true;
                        } else {
                            localStorage.removeItem(`saveSlot${i}`);
                        }
                    }
                    if (!hasValidSlot) {
                        showToast('Erro ao importar dados: nenhum slot válido encontrado!');
                        return;
                    }
                    updateSaveSlots();
                    showToast('Dados importados com sucesso!');
                    document.getElementById('file-name').textContent = 'Nenhum arquivo selecionado';
                    document.getElementById('submit-file').style.display = 'none';
                    fileInput.value = ''; // Reseta o input de arquivo
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    console.log('Conteúdo do arquivo:', e.target.result);
                    showToast(`Erro ao importar dados: ${error.message}`);
                }
            };
            reader.readAsText(file);
        }

        function showHistoryView(view) {
            currentHistoryView = view;
            currentPage = 1; // Resetar a página ao mudar de visualização
            document.getElementById('history-table-view').style.display = view === 'table' ? 'block' : 'none';
            document.getElementById('task-total-view').style.display = view === 'total' ? 'block' : 'none';
            document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.sub-tab-btn[onclick="showHistoryView('${view}')"]`).classList.add('active');
            if (view === 'table') {
                updateHistory();
            } else {
                updateTaskTotals();
            }
        }
        
        function filterTaskTotals(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.filter-btn[onclick="filterTaskTotals('${filter}')"]`).classList.add('active');
            updateTaskTotals();
        }
        
        function updateTaskTotals() {
            const grid = document.getElementById('task-total-grid');
            grid.innerHTML = '';
        
            // Group by task name
            const taskGroups = completedTasks.reduce((acc, task) => {
                if (!acc[task.name]) {
                    acc[task.name] = { 
                        count: 0, 
                        totalXP: 0, 
                        type: task.type, 
                        progress: [], // Store all progress values
                        dates: [] // Store completion dates
                    };
                }
                acc[task.name].count++;
                acc[task.name].totalXP += task.points || 0;
                acc[task.name].progress.push(task.progress || 0);
                acc[task.name].dates.push(new Date(task.completedDate.split('/').reverse().join('-')));
                return acc;
            }, {});
        
            // Filter based on currentFilter
            const filteredGroups = Object.entries(taskGroups).filter(([name, data]) => {
                if (currentFilter === 'repetitivo') {
                    return data.type === 'Diário' || data.type === 'Semanal';
                } else {
                    return data.type === 'Única';
                }
            });
        
            // Calculate averages for each period
            const today = new Date();
            filteredGroups.forEach(([name, data]) => {
                // Last 7 days
                const last7DaysProgress = data.progress.filter((prog, i) => {
                    const diffDays = Math.floor((today - data.dates[i]) / (1000 * 60 * 60 * 24));
                    return diffDays <= 7;
                });
                const avg7Days = last7DaysProgress.length > 0 
                    ? (last7DaysProgress.reduce((sum, prog) => sum + prog, 0) / last7DaysProgress.length).toFixed(1) 
                    : 0;
        
                // Last 30 days
                const last30DaysProgress = data.progress.filter((prog, i) => {
                    const diffDays = Math.floor((today - data.dates[i]) / (1000 * 60 * 60 * 24));
                    return diffDays <= 30;
                });
                const avg30Days = last30DaysProgress.length > 0 
                    ? (last30DaysProgress.reduce((sum, prog) => sum + prog, 0) / last30DaysProgress.length).toFixed(1) 
                    : 0;
        
                // Overall
                const avgOverall = data.progress.length > 0 
                    ? (data.progress.reduce((sum, prog) => sum + prog, 0) / data.progress.length).toFixed(1) 
                    : 0;
        
                // Render card
                const card = document.createElement('div');
                card.className = 'task-total-card';
                card.innerHTML = `
                    <h4>${name}</h4>
                    <p>Vezes Feita: ${data.count}</p>
                    <p>XP Total: ${data.totalXP}</p>
                    <div class="progress-bars">
                        <div class="progress-bar-container">
                            <label>Últ. 7 Dias: ${avg7Days}%</label>
                            <progress value="${avg7Days}" max="100"></progress>
                        </div>
                        <div class="progress-bar-container">
                            <label>Últ. 30 Dias: ${avg30Days}%</label>
                            <progress value="${avg30Days}" max="100"></progress>
                        </div>
                        <div class="progress-bar-container">
                            <label>Geral: ${avgOverall}%</label>
                            <progress value="${avgOverall}" max="100"></progress>
                        </div>
                    </div>
                    <div class="icons">
                        <i class="fas fa-trash" onclick="deleteTaskHistory('${name}')" title="Excluir Task do Histórico"></i>
                    </div>
                `;
                grid.appendChild(card);
            });
        
            if (filteredGroups.length === 0) {
                grid.innerHTML = '<p>Nenhuma task encontrada.</p>';
            }
        }


        function deleteTaskHistory(taskName) {
            if (!confirm(`Excluir todas as entradas de "${taskName}" do histórico? Essa ação não pode ser desfeita.`)) return;
            completedTasks = completedTasks.filter(task => task.name !== taskName);
            chartData = chartData.filter(task => task.name !== taskName);
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
            localStorage.setItem('chartData', JSON.stringify(chartData));
            currentPage = 1; // Resetar a página atual
            if (currentHistoryView === 'table') {
                updateHistory();
            } else {
                updateTaskTotals();
            }
            updateCharts();
            showToast(`Histórico de "${taskName}" apagado!`);
        }


        function showResetDialog() {
            const dialog = document.getElementById('reset-dialog');
            dialog.style.display = 'flex';
        }
        
        function closeResetDialog() {
            const dialog = document.getElementById('reset-dialog');
            dialog.style.display = 'none';
        }
        
        function resetTasks(type) {
            if (!confirm(`Tem certeza que deseja resetar todas as tasks ${type === 'daily' ? 'diárias' : 'semanais'}? Isso permitirá enviar novos dados.`)) {
                closeResetDialog();
                return;
            }
        
            tasks = tasks.map(task => {
                if (task.type === type) {
                    return {
                        ...task,
                        completed: false,
                        progress: 0
                    };
                }
                return task;
            });
        
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateTasksGrid();
            updateMissions(currentCategory);
            closeResetDialog();
            showToast(`Tasks ${type === 'daily' ? 'diárias' : 'semanais'} resetadas!`);
        }


        window.addEventListener('load', () => {
            init();
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                document.querySelector('.theme-btn i').className = 'fas fa-moon';
            }
            const inputs = document.querySelectorAll('input[type="range"]');
            inputs.forEach(input => input.style.setProperty('--value', input.value + '%'));
        });

        window.addEventListener('resize', () => {
            updateCharts();
        });
        


        function resetDailyTasks() {
            const today = new Date().toISOString().split('T')[0]; // Data atual no formato YYYY-MM-DD
            const lastDailyReset = localStorage.getItem('lastDailyReset');
        
            if (lastDailyReset !== today) {
                let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                
                // Resetar tarefas diárias: desmarcar como concluídas
                tasks = tasks.map(task => {
                    if (task.tipo === 'Diário') {
                        task.concluida = false;
                    }
                    return task;
                });
        
                // Salvar tasks atualizadas
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('lastDailyReset', today);
                console.log('Tarefas diárias resetadas automaticamente.');
            }
        }
        
        function resetWeeklyTasks() {
            const today = new Date();
            const isSunday = today.getDay() === 0; // 0 é domingo
            const currentWeek = getWeekNumber(today); // Função para obter número da semana
            const lastWeeklyReset = localStorage.getItem('lastWeeklyReset');
        
            if (isSunday && lastWeeklyReset !== currentWeek) {
                let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                
                // Resetar tarefas semanais: desmarcar como concluídas
                tasks = tasks.map(task => {
                    if (task.tipo === 'Semanal') {
                        task.concluida = false;
                    }
                    return task;
                });
        
                // Salvar tasks atualizadas
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('lastWeeklyReset', currentWeek);
                console.log('Tarefas semanais resetadas automaticamente.');
            }
        }
        
        // Função para calcular o número da semana no ano (ISO 8601)
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7; // Domingo é 0, ajusta para 7
            d.setUTCDate(d.getUTCDate() + 4 - dayNum); // Ajusta para o primeiro dia da semana
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }
        
        // Executa ambos os resets ao carregar a página
        window.addEventListener('load', () => {
            resetDailyTasks();
            resetWeeklyTasks();
            // Chame funções existentes para atualizar a UI, ex.:
            // loadTasks();
            // updateProgress();
        });



    </script>
    
</body>
</html>